<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML><HEAD>
<TITLE>reqtool.html</TITLE>
<!-- Source: reqtool -->
<!-- Generated with ROBODoc v3.2.2 (Sep  8 2000) -->
<!-- ROBODoc (c) 1994-2000 by Frans Slothouber and Jacco van Weert. -->
</HEAD><BODY BGCOLOR="#FFFFFF">
<A NAME="reqtool">Generated from reqtool</A> with ROBODoc v3.2.2 on Wed Jun 05 12:11:54 2002
<BR>
<H3 ALIGN="center">TABLE OF CONTENTS</H3>
<OL>
<LI><A HREF="#setup">reqtool/setup</A>
<LI><A HREF="#qconfig">reqtool/qconfig</A>
<LI><A HREF="#VERSION">reqtool/VERSION</A>
<LI><A HREF="#buttons">reqtool/buttons</A>
<LI><A HREF="#button_order">reqtool/button_order</A>
<LI><A HREF="#lock_write">reqtool/lock_write</A>
<LI><A HREF="#lock_append">reqtool/lock_append</A>
<LI><A HREF="#lock_read">reqtool/lock_read</A>
<LI><A HREF="#untaint_num">reqtool/untaint_num</A>
<LI><A HREF="#untaint_str">reqtool/untaint_str</A>
<LI><A HREF="#section_header">reqtool/section_header</A>
<LI><A HREF="#read_email">reqtool/read_email</A>
<LI><A HREF="#print_page">reqtool/print_page</A>
<LI><A HREF="#print_error">reqtool/print_error</A>
<LI><A HREF="#display_email">reqtool/display_email</A>
<LI><A HREF="#display_comments">reqtool/display_comments</A>
<LI><A HREF="#display_resolve">reqtool/display_resolve</A>
<LI><A HREF="#display_merge">reqtool/display_merge</A>
<LI><A HREF="#display_give">reqtool/display_give</A>
<LI><A HREF="#view_request">reqtool/view_request</A>
<LI><A HREF="#send_attachment">reqtool/send_attachment</A>
<LI><A HREF="#send_image">reqtool/send_image</A>
<LI><A HREF="#date_diff">reqtool/date_diff</A>
<LI><A HREF="#req_rescan">reqtool/req_rescan</A>
<LI><A HREF="#display_buttons">reqtool/display_buttons</A>
<LI><A HREF="#display_frames">reqtool/display_frames</A>
<LI><A HREF="#display_login">reqtool/display_login</A>
<LI><A HREF="#login_check">reqtool/login_check</A>
<LI><A HREF="#display_welcome">reqtool/display_welcome</A>
<LI><A HREF="#take_request">reqtool/take_request</A>
<LI><A HREF="#req_give_do">reqtool/req_give_do</A>
<LI><A HREF="#req_give">reqtool/req_give</A>
<LI><A HREF="#req_comments">reqtool/req_comments</A>
<LI><A HREF="#req_comments_do">reqtool/req_comments_do</A>
<LI><A HREF="#req_mail_do">reqtool/req_mail_do</A>
<LI><A HREF="#req_resolve">reqtool/req_resolve</A>
<LI><A HREF="#req_search">reqtool/req_search</A>
<LI><A HREF="#req_search_do">reqtool/req_search_do</A>
<LI><A HREF="#admin_forward">reqtool/admin_forward</A>
<LI><A HREF="#admin_forward_do">reqtool/admin_forward_do</A>
<LI><A HREF="#req_mail">reqtool/req_mail</A>
<LI><A HREF="#search_file">reqtool/search_file</A>
<LI><A HREF="#req_parameters">reqtool/req_parameters</A>
<LI><A HREF="#admin_main">reqtool/admin_main</A>
<LI><A HREF="#admin_users">reqtool/admin_users</A>
<LI><A HREF="#admin_users_do">reqtool/admin_users_do</A>
<LI><A HREF="#req_merge">reqtool/req_merge</A>
<LI><A HREF="#req_merge_do">reqtool/req_merge_do</A>
<LI><A HREF="#request_stats">reqtool/request_stats</A>
<LI><A HREF="#display_stats">reqtool/display_stats</A>
<LI><A HREF="#rebuild_indexes">reqtool/rebuild_indexes</A>
<LI><A HREF="#req_status">reqtool/req_status</A>
<LI><A HREF="#print_usage">reqtool/print_usage</A>
<LI><A HREF="#load_config">reqtool/load_config</A>
<LI><A HREF="#un_base64">reqtool/un_base64</A>
<LI><A HREF="#main_code">reqtool/main_code</A>
<LI><A HREF="#QUEUE_DIR">reqtool/QUEUE_DIR</A>
<LI><A HREF="#CGI_NAME">reqtool/CGI_NAME</A>
<LI><A HREF="#LISTNAME">reqtool/LISTNAME</A>
<LI><A HREF="#MAILING_LIST">reqtool/MAILING_LIST</A>
<LI><A HREF="#TMP_DIR">reqtool/TMP_DIR</A>
<LI><A HREF="#ADMIN_PASSWORD">reqtool/ADMIN_PASSWORD</A>
<LI><A HREF="#READ_USER">reqtool/READ_USER</A>
<LI><A HREF="#CHARSET">reqtool/CHARSET</A>
<LI><A HREF="#LDAP_SERVER">reqtool/LDAP_SERVER</A>
<LI><A HREF="#LDAP_BASE">reqtool/LDAP_BASE</A>
<LI><A HREF="#LDAP_BIND">reqtool/LDAP_BIND</A>
<LI><A HREF="#LDAP">reqtool/LDAP</A>
<LI><A HREF="#FORWARD_DIR">reqtool/FORWARD_DIR</A>
<LI><A HREF="#FORWARD_FILE">reqtool/FORWARD_FILE</A>
<LI><A HREF="#MIME_TYPES">reqtool/MIME_TYPES</A>
<LI><A HREF="#COUNTFILE">reqtool/COUNTFILE</A>
<LI><A HREF="#ACTIVE_DIR">reqtool/ACTIVE_DIR</A>
<LI><A HREF="#ACTIVE_INDEX">reqtool/ACTIVE_INDEX</A>
<LI><A HREF="#IMAGE_PATH">reqtool/IMAGE_PATH</A>
<LI><A HREF="#VALID_USERS">reqtool/VALID_USERS</A>
<LI><A HREF="#RESOLVED_DIR">reqtool/RESOLVED_DIR</A>
<LI><A HREF="#RESOLVED_INDEX">reqtool/RESOLVED_INDEX</A>
<LI><A HREF="#pod">reqtool/pod</A>
</OL>
<HR>

<H2><A NAME="setup">reqtool/setup</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   Setup section
</EM></PRE><FONT SIZE="+1">DESCRIPTION</FONT>
<PRE>   Loads required modules, sets some global variables,
   and other global things
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    #
    # Modules we use.
    #
    use strict;
    use CGI qw(:standard :html3 :netscape :cookie :escapeHTML);
    use CGI::Cookie;
    use MIME::Parser;
    use Sys::Hostname;
    use Date::Parse;
    use Fcntl ':flock';    # import LOCK_* constants
    
    # un-taint environment
    $ENV{'PATH'} = '/bin:/usr/bin';
    delete @ENV{ 'IFS', 'CDPATH', 'ENV', 'BASH_ENV' };    
</PRE>
<HR>

<H2><A NAME="qconfig">reqtool/qconfig</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   %<B>qconfig</B> - <A HREF="#reqtool">reqtool</A> instance configuration
</EM></PRE><FONT SIZE="+1">DESCRIPTION</FONT>
<PRE>   This is a large hash structure that contains all configuration
   for this instance of <A HREF="#reqtool">reqtool</A>
   The majority of its values are set in <A HREF="#load_config">load_config</A> based
   on values read from the queue configuration file
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    #
    # Site Configuration.
    # You should only have to edit the entry stating GLOBAL_DIR
    # if you moved <A HREF="#reqtool">reqtool</A> after installation
    #
    my %<B>qconfig</B>;
    
    # Where this script will be in absolute directory terms
    %<B>qconfig</B>-&gt;{'GLOBAL_DIR'} = "/usr/local/<A HREF="#reqtool">reqtool</A>";    
</PRE>
<HR>

<H2><A NAME="VERSION">reqtool/VERSION</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   $<B>VERSION</B>
</EM></PRE><FONT SIZE="+1">DESCRIPTION</FONT>
<PRE>   Version number of this installation of <A HREF="#reqtool">reqtool</A>
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    my $<B>VERSION</B>        = "0.12";    
</PRE>
<HR>

<H2><A NAME="buttons">reqtool/buttons</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   %<B>buttons</B>
</EM></PRE><FONT SIZE="+1">DESCRIPTION</FONT>
<PRE>   This structure contains a list of the available <B>buttons</B>
   The hash index is appended with 'req_' to give the function the button
   will call, the first parameter is the text of the button
   '.gif' is added to this text to detirmine the image.
   The final parameter to each entry is the frame which it will target
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    my (%<B>buttons</B>) = (
            'rescan'     =&gt; ['Rescan',     'req_top'],
            'take'       =&gt; ['Take',       '<A HREF="#req_status">req_status</A>'],
            'give'       =&gt; ['Give',       'req_top'],
            'mail'       =&gt; ['Mail',       'req_top'],
            'merge'      =&gt; ['Merge',      'req_bottom'],
            'resolve'    =&gt; ['Resolve',    '<A HREF="#req_status">req_status</A>'],
            'drop'       =&gt; ['Drop',       '<A HREF="#req_status">req_status</A>'],
            'search'     =&gt; ['Search',     'req_top'],
            'comments'   =&gt; ['Comments',   'req_top'],
            'parameters' =&gt; ['Parameters', '_new'],
            'statistics' =&gt; ['Statistics', '_new'],
    );    
</PRE>
<HR>

<H2><A NAME="button_order">reqtool/button_order</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   @<B>button_order</B>
</EM></PRE><FONT SIZE="+1">DESCRIPTION</FONT>
<PRE>   This is a list of the <A HREF="#buttons">buttons</A> to be displayed
   and the order they will be in
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    my (@<B>button_order</B>) = (
            'rescan',   'take',       'give',     'mail',
            'merge',    'resolve',    'drop',     'search',
            'comments', 'parameters', 'statistics'
    );    
</PRE>
<HR>

<H2><A NAME="lock_write">reqtool/lock_write</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>lock_write</B> --  Lock a file for overwriting
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>lock_write</B> ( $filename )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Create an exclusive lock on given file and blanks the file
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $filename - filename to lock
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>lock_write</B> {
            my $FILE = shift;
            flock($FILE, LOCK_EX);
            seek($FILE, 0, 0);
            truncate($FILE, 0);
    } ## end sub <B>lock_write</B>    
</PRE>
<HR>

<H2><A NAME="lock_append">reqtool/lock_append</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>lock_append</B> -- lock a file for appending
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>lock_append</B> ( $filename )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Create an exclusive lock on given file
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $filename - filename to lock
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>lock_append</B> {
            my $FILE = shift;
            flock($FILE, LOCK_EX);
    }    
</PRE>
<HR>

<H2><A NAME="lock_read">reqtool/lock_read</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>lock_read</B> -- lock a file for reading
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>lock_read</B> ( $filename )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Create a shared lock on given file
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $filename - filename to lock
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>lock_read</B> {
            my $FILE = shift;
            flock($FILE, LOCK_SH);
    }    
</PRE>
<HR>

<H2><A NAME="untaint_num">reqtool/untaint_num</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>untaint_num</B> -- make a number untainted
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $num = <B>untaint_num</B> ( $num )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Returns a blank if the string contains anything other than a number or 'R'
   The 'R' is allowed since request numbers may contain one
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $num - a possibly tainted number
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $num - a clean number or blank if original was tainted
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>untaint_num</B> {
            my $num = shift;
            $num =~ /^([\dR]+)$/;
            return $1;
    }    
</PRE>
<HR>

<H2><A NAME="untaint_str">reqtool/untaint_str</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>untaint_str</B> --  untaint a string
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $string = <B>untaint_str</B> ( $string )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Checks if a string is tainted and returns it otherwise exits
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $string - a possibly tainted string
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $string - a clean string
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>untaint_str</B> {
            my $string = shift;
            if ($string eq "") {
                    return $1;
            } elsif ($string =~ /^([-\@\w=\.\/ \,]+)$/) {
                    return $1;
            } else {
                    <A HREF="#print_error">print_error</A>("Tainted data in $string");
            }
    } ## end sub <B>untaint_str</B>    
</PRE>
<HR>

<H2><A NAME="section_header">reqtool/section_header</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>section_header</B> -- Return nicely formatted section header
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $string = <B>section_header</B> ( $title, $bgcolor, $req )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Return nicely formatted section header containing the title given, at
   the color given and with a link to reload the request given
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $title   - title of header
   $bgcolor - color of section header
   $req     - request number
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $text - string containing header as html source
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>section_header</B> {
            my ($title, $bgcolor, $req) = @_;
            my $header =
              "&lt;table border=0 cellpadding=0 cellspacing=0 width=100%&gt;&lt;tr bgcolor="
              . $bgcolor
              . "&gt;\n&lt;td&gt;";
            $header .= $title . "&lt;/td&gt;\n&lt;td align=right&gt;";
            $header .= "&lt;a href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=view&amp;req="
              . $req
              . "\" target=req_bottom&gt;&lt;img src=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=getimage&amp;image=refresh\" border=0&gt;&lt;/a&gt;";
            $header .= "&lt;/td&gt;\n&lt;/tr&gt;&lt;/table&gt;&lt;br&gt;\n";
            return $header;
    } ## end sub <B>section_header</B>    
</PRE>
<HR>

<H2><A NAME="read_email">reqtool/read_email</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>read_email</B> -- Read in a email and turn into a request
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>read_email</B> ()
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Read in a email and turn into a request.
   If the request exists, add to it
   If the request was closed, re-open it
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   STDIN - email message passed via stdin
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   New/modified request to queue
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>read_email</B> {
            my ($from)     = "";
            my ($count)    = 0;
            my ($boundary) = "";
            my ($OUTFILE)  = "";
            my ($entity, $head, $subject, $preexists, $wasresolve, $oldpath, $bodyfile,
                    $type);
            my ($attachpath, $request_dir);
    
            # Create a new parser object
            my $parser = new MIME::Parser;
            $parser-&gt;output_under(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#TMP_DIR">TMP_DIR</A>'});
            $parser-&gt;extract_nested_messages(0);
    
            $entity = $parser-&gt;read(\*STDIN)
              or print STDERR "Couldn't parse MIME; continuing...\n";
    
            my $results = $parser-&gt;results;
            $head = $results-&gt;top_head;
    
            # Find subject and check if it relates to an existing request
            # If it does then set request number accordingly, otherwise
            # set request number to counter
            chomp($subject = $head-&gt;get('Subject', 0));
            $subject =~ s/\n//m;    # remove embedded newline
            my $listname = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LISTNAME">LISTNAME</A>'};
            if ($subject =~ /\[\s+$listname\s+#(\d+).*\]/i) {
                    $count     = $1;
                    $preexists = 1;
            } else {
                    open(REQ, "&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#COUNTFILE">COUNTFILE</A>'}) or $count = 1;
                    <A HREF="#lock_read">lock_read</A>(\*REQ);
    
                    if ($count == 0) {
                            <A HREF="#lock_read">lock_read</A>(\*REQ);
                            $count = &lt;REQ&gt;;
                            close REQ;
                    }
    
                    if ($count == 1) {
                            open(REQ, "&gt; " . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#COUNTFILE">COUNTFILE</A>'});
                    } else {
                            open(REQ, "+&lt; " . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#COUNTFILE">COUNTFILE</A>'});
                            <A HREF="#lock_write">lock_write</A>(\*REQ);
                    }
                    print REQ ($count + 1);
                    close REQ;
                    $preexists = 0;
            } ## end else
    
            # Check if message is multi-part/alternative and handle
            if ($entity-&gt;parts) {
                    if ($entity-&gt;parts(0)-&gt;bodyhandle) {
                            $oldpath = $entity-&gt;parts(0)-&gt;bodyhandle-&gt;path;
                    } else {
                            $oldpath = $entity-&gt;parts(0)-&gt;parts(0)-&gt;bodyhandle-&gt;path;
                    }
            } else {
                    $oldpath = $entity-&gt;bodyhandle-&gt;path;
            }
    
            # Get temporary directory and parse
            $bodyfile   = $oldpath;
            $attachpath = $oldpath;
            my $tmppath = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#TMP_DIR">TMP_DIR</A>'};
            $attachpath =~ s/$tmppath\/(.*)\/(.*)$/$1/g;
            $bodyfile   =~ s/(.*)\/(.*)$/$2/g;
            $oldpath    =~ s/(.*)\/(.*)$/$1/g;
            $request_dir = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/" . $count;
    
            if ($request_dir =~ /^([-\@\w.\/]+)$/) {
                    $request_dir = $1;
            } else {
                    <A HREF="#print_error">print_error</A>("Bad path data");
            }
    
            # If active directory doesn't exist, create it
            if (!-e %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'}) {
                    mkdir(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'}, 0775);
            }
    
            # If the request was previously resolved, reopen it
            if (($preexists)
                    &amp;&amp; (!-e $request_dir)
                    &amp;&amp; (-e %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'} . "/" . $count))
            {
                    system("/usr/bin/mv "
                              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'} . "/"
                              . $count . " "
                              . $request_dir);
                    system("cp "
                              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'} . " "
                              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'}
                              . "~");
                    open(IN, "&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'} . "~")
                      || die "Cannot open: $!";
                    <A HREF="#lock_read">lock_read</A>(\*IN);
                    open(OUT, "+&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'})
                      || die "Cannot create: $!";
                    <A HREF="#lock_write">lock_write</A>(\*OUT);
                    open(AINDEX, "&gt;&gt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'})
                      || die ("Couldn't open active index");
                    <A HREF="#lock_append">lock_append</A>(\*AINDEX);
    
                    while ($_ = &lt;IN&gt;) {
                            my @line = split (/\|/, $_, 6);
                            if ($line[0] == $count . "R") {
                                    $line[0] =~ s/R//g;
                                    print AINDEX $line[0] . "|"
                                      . $line[1] . "|"
                                      . $line[2]
                                      . "|open|"
                                      . $line[4] . "|"
                                      . $line[5];
                            } else {
                                    print OUT $_;
                            }
                    } ## end while ($_ = &lt;IN&gt;)
                    close AINDEX;
                    close OUT;
                    close IN;
                    unlink "%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'}~";
            } ## end if (($preexists) &amp;&amp; (!...
    
            # Make requisite directories for request, email and attachments
            mkdir($request_dir, 0775);
            mkdir($request_dir . "/" . $attachpath, 0775);
    
            # Copy all attachments over
            system("/usr/bin/cp " . $oldpath . "/* "
                      . $request_dir . "/"
                      . $attachpath
                      . "/");
    
            # Remove temporary files
            system("/usr/bin/rm -rf " . $oldpath);
    
            # Add section to request.contents recording event
            open(REQTRACK, "&gt;&gt;$request_dir/request.contents")
              || <A HREF="#print_error">print_error</A>("Couldn't create $request_dir/request.contents");
    
            <A HREF="#lock_append">lock_append</A>(\*REQTRACK);
            print REQTRACK "-- New Action --\n";
            print REQTRACK "Action: Mail\n";
            print REQTRACK "To: " . $head-&gt;get('To', 0);
            print REQTRACK "Cc: ";
    
            if ($head-&gt;get('Cc', 0)) {
                    my $cc = $head-&gt;get('Cc', 0);
                    $cc =~ s/\n//m;    # remove embedded newline
                    print REQTRACK $cc;
            }
            print REQTRACK "\n";
            if (!$head-&gt;get('Cc', 0)) { print REQTRACK "\n"; }
            print REQTRACK "From: " . $head-&gt;get('From', 0);
            if ($head-&gt;get('Subject', 0)) {
                    my $subject = $head-&gt;get('Subject', 0);
                    $subject =~ s/\n/ /g;
                    print REQTRACK "Subject: " . $subject . "\n";
            } else {
                    print REQTRACK "Subject: (no subject)\n";
            }
            print REQTRACK "Path: " . $attachpath . "\n";
            print REQTRACK "Body: " . $bodyfile . "\n";
            print REQTRACK "Date: " . localtime(time) . "\n";
            if ($head-&gt;get('Content-Type')) {
                    print REQTRACK "Content-Type: " . $head-&gt;get('Content-Type');
            }
            print REQTRACK "-- End Action --\n";
            chmod 0755, $request_dir . "/" . $attachpath;
    
            # If this is new then add it to the index
            if (!$preexists) {
                    open(INDEX, "&gt;&gt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'})
                      || <A HREF="#print_error">print_error</A>("Couldn't open active index");
                    chomp($from = $head-&gt;get('From', 0));
                    if ($head-&gt;get('Subject', 0)) {
                            chomp($subject = $head-&gt;get('Subject', 0));
                    } else {
                            $subject = "(no subject)";
                    }
                    <A HREF="#lock_append">lock_append</A>(\*INDEX);
                    $subject =~ s/\n/ /g;    # remove embedded newlines
                    print INDEX $count . "|none|" . time . "|open|" . $from . "|" . $subject
                      . "\n";
                    close INDEX;
            } ## end if (!$preexists)
    } ## end sub <B>read_email</B>    
</PRE>
<HR>

<H2><A NAME="print_page">reqtool/print_page</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>print_page</B> -- Display text as html page
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>print_page</B> ( $title, $contents, $header )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Takes the page contents and outputs it to the web server (stdout)
   Always called as last subroutine.
   If header is not specified, default provided
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $title    - Page title
   $contents - Page contents
   $header   - page header (optional) contains cookies etc
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   HTML page to STDOUT
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>print_page</B> {
            my ($title, $contents, $header) = @_;
            if ($header) {
                    print $header;
            } else {
                    print header (
                            -title =&gt; $title,
                            -type  =&gt; "text/html; charset=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CHARSET">CHARSET</A>'},
                            -pragma =&gt; "no-cache",
                            -expires =&gt; "now"
                    );
            } ## end else
    
            print "&lt;html&gt;\n";
            print "&lt;head&gt;&lt;title&gt;".$title."&lt;/title&gt;&lt;/head&gt;\n";
            print "&lt;body bgcolor=#eeeeee&gt;\n";
            print $contents;
            print "&lt;/body&gt;\n&lt;/html&gt;\n";
            exit 1;
    } ## end sub <B>print_page</B>    
</PRE>
<HR>

<H2><A NAME="print_error">reqtool/print_error</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>print_error</B> -- Display error as html page
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>print_error</B> ( $error_in )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Creates a form html contents for delivery of error messages
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $error_in - error message
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> for display of HTML
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>print_error</B> {
            my ($error_in) = @_;
            my $error;
    
            $error = "&lt;center&gt;&lt;h1&gt;You have encountered an error&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;\n"
            . "&lt;hr&gt;\n"
            . "&lt;font size=+1&gt;Normally this is caused by trying to do an action on a non-existant request&lt;br&gt;\n"
            . "For example, if you haven't chosen a request or the request has been resolved since you last checked&lt;br&gt;\n"
            . "&lt;br&gt;\nPress &lt;a href=\"javascript:history.go(-1)\"&gt;Here&lt;/a&gt; to go back and try again&lt;br&gt;&lt;br&gt;\n"
            . "Error Was: &lt;b&gt;&lt;i&gt;" . $error_in . "&lt;/i&gt;&lt;/b&gt;&lt;br&gt;&lt;/font&gt;\n"
            . "If, after trying again, it still fails please contact the"
            . "<A HREF="#reqtool">reqtool</A> administrator and tell them the text of the error&lt;br&gt;\n";
            <A HREF="#print_page">print_page</A>("Error Encountered", $error);
            exit 1;
    } ## end sub <B>print_error</B>    
</PRE>
<HR>

<H2><A NAME="display_email">reqtool/display_email</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_email</B> -- Output an single email
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $email = <B>display_email</B> ( $message, $request_dir, $req )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Takes an email message from a request and displays it
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $message     - email as a MIME::Message object
   $request_dir - directory where request is located
   $req         - request number
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $email - HTML representation of message
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_email</B> {
            my ($message, $request_dir, $req) = @_;
            my ($email) = "";
            my ($attachments, $attachnum, $attach, $attach2, @message, $reqnum);
    
            # Email header fields
            $email = <A HREF="#section_header">section_header</A>("&lt;h2&gt;Message&lt;/h2&gt;", "lightblue", $req);
            $email .= "&lt;b&gt;From: &lt;i&gt;" . escapeHTML($message-&gt;{'From'}) . "&lt;/i&gt;&lt;br&gt;\n";
            $message-&gt;{'Subject'} =~ s/(\?\=)\r?\n[\040\t]+(\=\?)/$1$2/sg;
            $message-&gt;{'Subject'} =~
              s/\=\?([\w\-]+)\?B\?([A-Za-z0-9\+\/]+\=*)\?\=/&amp;<A HREF="#un_base64">un_base64</A>($2,$1)/gex;
            $email .= "Subject: &lt;i&gt;" . $message-&gt;{'Subject'} . "&lt;/i&gt;&lt;br&gt;\n";
            $email .= "To: &lt;i&gt;" . escapeHTML($message-&gt;{'To'}) . "&lt;/i&gt;&lt;br&gt;\n";
            $email .= "Cc: &lt;i&gt;";
    
            if ($message-&gt;{'Cc'}) {
                    $email .= escapeHTML($message-&gt;{'Cc'});
            }
            $email .= "&lt;/i&gt;&lt;br&gt;\n";
            $email .= "Date: &lt;i&gt;" . $message-&gt;{'Date'} . "&lt;/i&gt;&lt;/b&gt;&lt;br&gt;\n";
            if (!($message-&gt;{'Content-Type'})) {
                    $message-&gt;{'Content-Type'} = "";
            }
    
            # If the email is not a HTML mail then wrap it
            if (!($message-&gt;{'Content-Type'} =~ /text\/html/)) {
                    $email .= "&lt;pre wrap&gt;\n";
            }
    
            # Find message boddy and display
            $request_dir = $request_dir . "/" . $message-&gt;{'Path'};
    
            if (!open(MESSAGE, $request_dir . "/" . $message-&gt;{'Body'})) {
                    <A HREF="#print_error">print_error</A>(
                            "Couldn't open " . $request_dir . "/" . $message-&gt;{'Body'} . "\n");
            } else {
                    <A HREF="#lock_read">lock_read</A>(\*MESSAGE);
    
                    while (&lt;MESSAGE&gt;) {
                            if (!($message-&gt;{'Content-Type'} =~ /text\/html/)) {
                                    $email .= escapeHTML($_);
                            } else {
    
                                    #$_=~ s/&lt;?html.*&gt;//g;
                                    #$_=~ s/&lt;?body.*&gt;//g;
                                    if (!((/\&lt;.*html.*\&gt;/) || (/\&lt;.*body.*\&gt;/))) {
                                            $email .= $_;
                                    }
                            } ## end else
                    } ## end while (&lt;MESSAGE&gt;)
                    close MESSAGE;
            } ## end else
            if (!($message-&gt;{'Content-Type'} =~ /text\/html/)) {
                    $email .= "\n&lt;/pre&gt;";
            }
            $email .= "&lt;br&gt;\n";
    
            # Show any attachments
            $attachments = <A HREF="#section_header">section_header</A>("&lt;h3&gt;Attachments&lt;/h3&gt;", "pink", $req);
    
            if (!opendir(DIR, $request_dir)) {
                    <A HREF="#print_error">print_error</A>("can't opendir " . $request_dir . ": $!");
            } else {
                    $attachnum = 0;
                    while ($attach = readdir(DIR)) {
                            if ($attach =~ /^\./) {
    
                                    #ignore
                            } elsif ($attach =~ /$message-&gt;{'Body'}/) {
    
                                    # also ignore
                            } else {
                                    $attachnum++;
                                    $attachments .=
    "&lt;table bgcolor=#ccccdd border=1&gt;&lt;tr&gt;&lt;td bgcolor=#ddcccc&gt;Attachment "
                                      . $attachnum
                                      . "&lt;/td&gt;&lt;/tr&gt;\n";
                                    $attachments .= "&lt;tr&gt;&lt;td&gt;";
                                    $attach2 = $attach;
                                    $attach2 =~ s/ /\%20/g;
                                    $reqnum = $req;
                                    $reqnum =~ s/R//g;
                                    $attachments .= "&lt;a href=\""
                                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                                      . "?command=download&amp;req="
                                      . $req
                                      . "&amp;file="
                                      . $reqnum . "/"
                                      . $message-&gt;{'Path'} . "/"
                                      . $attach2
                                      . "\" target=\"_new\"&gt;"
                                      . $attach;
                                    $attachments .= "&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;\n";
                                    $attachments .= "&lt;/table&gt;\n";
                            } ## end else
                    } ## end while ($attach = readdir(...
    
                    if ($attachnum) {
                            $email .= $attachments;
                    }
                    close DIR;
            } ## end else
            $email .= "\n";
    
            return scalar $email;
    } ## end sub <B>display_email</B>    
</PRE>
<HR>

<H2><A NAME="display_comments">reqtool/display_comments</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_comments</B> -- Output comments
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $text = <B>display_comments</B> ( $req, $message )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Takes a comment from a request and outputs it
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req     - request number
   $message - message containing comments
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $text - comments as HTML
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_comments</B> {
            my ($req, $message) = @_;
            my ($comments);
    
            $comments = <A HREF="#section_header">section_header</A>("&lt;h2&gt;Comments&lt;/h2&gt;", "lightgreen", $req);
            $comments .= "&lt;b&gt;Comments added by &lt;i&gt;"
              . $message-&gt;{'Action-By'}
              . "&lt;/i&gt; on &lt;i&gt;"
              . $message-&gt;{'Date'}
              . "&lt;/i&gt;&lt;br&gt;&lt;br&gt;\n";
            $comments .= $message-&gt;{'Comments'};
            $comments .= "\n";
    
            return $comments;
    } ## end sub <B>display_comments</B>    
</PRE>
<HR>

<H2><A NAME="display_resolve">reqtool/display_resolve</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_resolve</B> -- Output resolved section
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $text = <B>display_resolve</B> ( $req, $message )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Output a html section stating that the request was resolved
   Different text is shown if the request was dropped
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req     - request number
   $message - section describing resolve
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $text - HTML describing resolve action
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_resolve</B> {
            my ($req, $message) = @_;
            my $comments;
    
            if ($message-&gt;{'Action-By'} eq "dropped") {
                    $comments = <A HREF="#section_header">section_header</A>("&lt;h2&gt;Dropped&lt;/h2&gt;", "red", $req);
                    $comments .=
                      "&lt;b&gt;Dropped on &lt;i&gt;" . $message-&gt;{'Date'} . "&lt;/i&gt;&lt;br&gt;&lt;br&gt;\n";
            } else {
                    $comments = <A HREF="#section_header">section_header</A>("&lt;h2&gt;Resolved&lt;/h2&gt;", "red", $req);
                    $comments .= "&lt;b&gt;Resolved by &lt;i&gt;"
                      . $message-&gt;{'Action-By'}
                      . "&lt;/i&gt; on &lt;i&gt;"
                      . $message-&gt;{'Date'}
                      . "&lt;/i&gt;&lt;br&gt;&lt;br&gt;\n";
            } ## end else
            $comments .= "\n";
    
            return $comments;
    } ## end sub <B>display_resolve</B>    
</PRE>
<HR>

<H2><A NAME="display_merge">reqtool/display_merge</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_merge</B> -- Output merge
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $text = <B>display_merge</B> ( $req, $message )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Outputs section saying request was merged with another
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req     - request number
   $message - section describing merge
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $text - HTML describing merge
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_merge</B> {
            my ($req, $message) = @_;
            my $comments;
    
            $comments = <A HREF="#section_header">section_header</A>("&lt;h2&gt;Merged&lt;/h2&gt;", "red", $req);
            $comments .= "&lt;b&gt;Contents Merged from Request &lt;i&gt;"
              . $message-&gt;{'Request-Merged'}
              . "&lt;/i&gt; on &lt;i&gt;"
              . $message-&gt;{'Date'}
              . "&lt;/i&gt;&lt;/b&gt;&lt;br&gt;&lt;br&gt;\n";
    
            return $comments;
    } ## end sub <B>display_merge</B>    
</PRE>
<HR>

<H2><A NAME="display_give">reqtool/display_give</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_give</B> -- Output a section showing that request was given
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $text = <B>display_give</B> ( $req, $message )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req     - request number
   $message - section describing give
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $text - HTML describing 'give'
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_give</B> {
            my ($req, $message) = @_;
            my ($give);
    
            $give = <A HREF="#section_header">section_header</A>("&lt;h2&gt;Give Request to User&lt;/h2&gt;", "lightgreen", $req);
            $give .= "&lt;b&gt;Given by &lt;i&gt;" . $message-&gt;{'Giver'} . "&lt;/i&gt; to &lt;i&gt;" . $message-&gt;{'Owner'} . "&lt;/i&gt; on &lt;i&gt;" . $message-&gt;{'Date'} . "&lt;/i&gt;&lt;/b&gt;&lt;br&gt;\n";
    
            return $give;
    } ## end sub <B>display_give</B>    
</PRE>
<HR>

<H2><A NAME="view_request">reqtool/view_request</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>view_request</B> -- view a single request
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>view_request</B> ( $req )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Loads a request and then, by calling other subroutines, displays it as html
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req - request number
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   HTML page display by calling <A HREF="#print_page">print_page</A>
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>view_request</B> {
            my ($req) = @_;
            my (
                    $request_dir, $submessage, @line,   @message, $sub,
                    $contents,    $cookie,     $header, $rest,    $reqtrack
            );
    
            $reqtrack = $req;
    
            # Check if this is a resolved request
            if ($req =~ /R/) {
                    $req =~ s/^(.*)R$/$1/g;
                    $request_dir = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'} . "/" . $req;
            } else {
                    $request_dir = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/" . $req;
            }
    
            # If we can't open the request see if it was recently resolved
            if (!open(REQTRACK, "$request_dir/request.contents")) {
    
                    # try resolved
                    $request_dir = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'} . "/" . $req;
                    $reqtrack    = $req . "R";
                    open(REQTRACK, "$request_dir/request.contents")
                      || <A HREF="#print_error">print_error</A>("Couldn't open $request_dir/request.contents");
            } ## end if (!open(REQTRACK, "$request_dir/request.contents"...
            <A HREF="#lock_read">lock_read</A>(\*REQTRACK);
    
            # Load the request into the $message structure
            $submessage = 0;
            while (&lt;REQTRACK&gt;) {
                    if (/^-- New Action --/) {
    
                            # New Reqtool action
                            $submessage++;
                            while (!/-- End Action --/) {
                                    $_ = &lt;REQTRACK&gt;;
                                    if (!/-- End Action --/) {
                                            @line = split (/: /, $_, 2);
    
                                            if ($line[1]) {
                                                    chomp($line[1]);
                                                    chomp($rest = $_);
                                                    $rest =~ s/^(.*?): (.*)$/$2/g;
                                                    $message[$submessage]-&gt;{ $line[0] } = $rest;
                                            } else {
                                                    $message[$submessage]-&gt;{'Comments'} .= $_;
                                            }
                                    } ## end if (!/-- End Action --/...
                            } ## end while (!/-- End Action --/...
                    } ## end if (/^-- New Action --/...
            } ## end while (&lt;REQTRACK&gt;)
            close REQTRACK;
    
            # Set default type
            my $type = "text/html";
            $contents = "&lt;center&gt;&lt;h1&gt;Request Number " . $reqtrack . "&lt;/h1&gt;&lt;/center&gt;";
    
            # For each action on the request call the relevant function
            # to display the action
            foreach $sub (1 .. $submessage) {
                    if ($message[$sub]-&gt;{'Action'} eq "Mail") {
    
                            # Handle non-english emails
                            if (($message[$sub]-&gt;{'Content-Type'})
                                    &amp;&amp; ($message[$sub]-&gt;{'Content-Type'} =~ /charset/))
                            {
                                    $type = $message[$sub]-&gt;{'Content-Type'};
                                    $type =~ s/^.*charset=\"(.*)\".*/$1/g;
                                    $type = "text/html; charset=" . $type;
                            } elsif ($message[$sub]-&gt;{'Subject'} =~ /^=\?ISO/) {
                                    $type = $message[$sub]-&gt;{'Subject'};
                                    $type =~ s/^.*(ISO-[0-9]*-[A-Z]*).*$/$1/;
                                    $type = "text/html; charset=" . $type;
                            }
                            $contents .= <A HREF="#display_email">display_email</A>($message[$sub], $request_dir, $reqtrack);
                    } elsif ($message[$sub]-&gt;{'Action'} eq "Give") {
                            $contents .= <A HREF="#display_give">display_give</A>($reqtrack, $message[$sub]);
                    } elsif ($message[$sub]-&gt;{'Action'} eq "Resolve") {
                            $contents .= <A HREF="#display_resolve">display_resolve</A>($reqtrack, $message[$sub]);
                    } elsif ($message[$sub]-&gt;{'Action'} eq "Merge") {
                            $contents .= <A HREF="#display_merge">display_merge</A>($reqtrack, $message[$sub]);
                    } elsif ($message[$sub]-&gt;{'Action'} eq "Comments") {
                            $contents .= <A HREF="#display_comments">display_comments</A>($reqtrack, $message[$sub]);
                    }
            } ## end foreach $sub (1 .. $submessage...
    
            $cookie = new CGI::Cookie(
                    -name  =&gt; 'request',
                    -value =&gt; $reqtrack,
                    -path  =&gt; %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
            );
            $header = header(
                    -cookie =&gt; $cookie,
                    -pragma =&gt; "no-cache",
                    -expires =&gt; "now",
                    -type   =&gt; $type
            );
            $contents .= "&lt;script&gt;\n";
            $contents .= "top.req_status.location.href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=<A HREF="#req_status">req_status</A>\"\n";
            $contents .= "top.req_top.location.reload()\n";
            $contents .= "&lt;/script&gt;\n";
            <A HREF="#print_page">print_page</A>("Request " . $req, $contents, $header);
    } ## end sub <B>view_request</B>    
</PRE>
<HR>

<H2><A NAME="send_attachment">reqtool/send_attachment</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>send_attachment</B> -- send a file to user
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>send_attachment</B> ( $file )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Sends a file to the user
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $file - the filename of the file to send
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   file as mime stream to stdout
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>send_attachment</B> {
            my ($file) = @_;
            my ($att_header, $attach, $att_buffer, $extension, $mime_type);
    
            # Find attachment and read it into $att_buffer
            $attach = $file;
            $attach =~ s/(.*)\/(.*)$/$2/g;
            if (!open(ATTACH, $file)) {
                    <A HREF="#print_error">print_error</A>("Couldn't open $file : $!\n");
            } else {
                    <A HREF="#lock_read">lock_read</A>(\*ATTACH);
                    sysread(ATTACH, $att_buffer, (stat($file))[7]);
                    close(ATTACH);
            }
    
            # Find the files mime-type
            if (open(MIME, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#MIME_TYPES">MIME_TYPES</A>'})) {
                    <A HREF="#lock_read">lock_read</A>(\*MIME);
                    $extension = $attach;
                    $extension =~ s/^(.*)\.(.*)$/$2/g;
                    $mime_type = "";
                    while ($_ = &lt;MIME&gt;) {
    
                            if (/$extension/) {
                                    $_ =~ s/^(.*?)\s(.*)$/$1/g;
                                    $mime_type = $_;
                                    last;
                            }
                    } ## end while ($_ = &lt;MIME&gt;)
                    close MIME;
    
                    if (!$mime_type) {
                            $mime_type = "application/octet-stream";
                    }
            } else {
                    if ($attach =~ /txt$/) {
                            $mime_type = "text/plain";
                    } else {
                            $mime_type = "application/octet-stream";
                    }
            } ## end else
            chomp $mime_type;
    
            # Send attachment
            $att_header = header(
                    -disposition =&gt; 'attachment;filename=\"$attach\"',
                    -type        =&gt; $mime_type
            );
    
            syswrite(STDOUT, $att_header, length($att_header));
            syswrite(STDOUT, $att_buffer, (stat($file))[7]);
    } ## end sub <B>send_attachment</B>    
</PRE>
<HR>

<H2><A NAME="send_image">reqtool/send_image</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>send_image</B> -- Send an image to browser
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>send_image</B> ( $image )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Sends an image to browser which is used for command <A HREF="#buttons">buttons</A>
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $image - name of image to send
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   image as mime to stdout
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>send_image</B> {
            my ($image) = @_;
            my ($file, $att_buffer, $att_header);
    
            $image = <A HREF="#untaint_str">untaint_str</A> ($image);
    
            # Convert image name to filename
            $file = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#IMAGE_PATH">IMAGE_PATH</A>'} . "/" . $image . ".gif";
    
            # Read the image into buffer
            if (!open(ATTACH, $file)) {
                    $att_buffer = "";
            } else {
                    <A HREF="#lock_read">lock_read</A>(\*ATTACH);
                    sysread(ATTACH, $att_buffer, (stat($file))[7]);
                    close(ATTACH);
            }
    
            # Send image to stdout
            $att_header = header(
                    -expires     =&gt; '+3M',
                    -disposition =&gt; 'attachment;filename=\"$image\".gif',
                    -type        =&gt; 'image/gif'
            );
    
            syswrite(STDOUT, $att_header, length($att_header));
            syswrite(STDOUT, $att_buffer, (stat($file))[7]);
    } ## end sub <B>send_image</B>    
</PRE>
<HR>

<H2><A NAME="date_diff">reqtool/date_diff</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>date_diff</B> -- Return the difference between two dates
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $diff = <B>date_diff</B> ( $old, $new )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Returns the difference between two dates in human readable form (ie 1 week)
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $old - first date
   $new - second date
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $diff - difference in human readable form
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>date_diff</B> {
            my ($old, $new) = @_;
            my ($diff, $minute, $hour, $day, $week, $month, $year, $s, $string);
    
            $diff = $new - $old;
    
            # Define measures in seconds
            $minute = 60;
            $hour   = 60 * $minute;
            $day    = 24 * $hour;
            $week   = 7 * $day;
            $month  = 4 * $week;
            $year   = 356 * $day;
    
            # Convert difference in seconds to human readable form
            if ($diff &lt; $minute) {
                    $s      = $diff;
                    $string = "sec";
            } elsif ($diff &lt; $hour) {
                    $s      = int($diff / $minute);
                    $string = "min";
            } elsif ($diff &lt; $day) {
                    $s      = int($diff / $hour);
                    $string = "hr";
            } elsif ($diff &lt; $week) {
                    $s      = int($diff / $day);
                    $string = "day";
            } elsif ($diff &lt; $month) {
                    $s      = int($diff / $week);
                    $string = "wk";
            } elsif ($diff &lt; $year) {
                    $s      = int($diff / $month);
                    $string = "mth";
            } else {
                    $s      = int($diff / $year);
                    $string = "yr";
            }
    
            # Handle plurals
            if ($s &gt; 1) {
                    $string .= "s";
            }
    
            return "$s $string";
    } ## end sub <B>date_diff</B>    
</PRE>
<HR>

<H2><A NAME="req_rescan">reqtool/req_rescan</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_rescan</B> -- Display a table of all active requests
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_rescan</B> ( $req )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Display a table of all active requests
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req    - current selected request number
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display table
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_rescan</B> {
            my ($req) = @_;
            my ($contents, @request, $age, $header);
    
            # First make sure index exists
            if (!open(INDEX, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'})) {
                    $contents = "&lt;center&gt;&lt;h1&gt;No Requests Exist&lt;/h1&gt;&lt;/center&gt;\n";
            } else {
                    <A HREF="#lock_read">lock_read</A>(\*INDEX);
    
                    # Table header
                    $contents = "&lt;center&gt;\n&lt;table border=2 cellpadding=5&gt;\n";
                    $contents .=
                      "&lt;tr&gt;&lt;th colspan=6 bgcolor=#ffffcc&gt;Queue == active&lt;/th&gt;&lt;/tr&gt;\n";
                    $contents .=
    "&lt;tr bgcolor=#99ffcc&gt;&lt;td&gt;&lt;b&gt;Request&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Owner&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Age&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Status&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;From&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Subject&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;\n";
    
                    # First item is a form item to create a new request
                    $contents .= "&lt;tr&gt;&lt;td bgcolor=#ccccff align=center colspan=6&gt;&lt;a href=\""
                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                      . "?command=<A HREF="#req_mail">req_mail</A>&amp;req=0"
                      . "\" target=\"req_bottom\"&gt;Create new request&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;\n";
    
                    # Parse the index file and display all open requests
                    while (&lt;INDEX&gt;) {
                            @request = split (/\|/, $_, 6);
                            $contents .= "&lt;tr&gt;\n";
                            my $reqtrack = $req;
                            $reqtrack =~ s/R//g;
                            if ($request[0] == $reqtrack) {
                                    $contents .= "&lt;td bgcolor=#ccccff align=right&gt;&lt;a name=\"Current\"&gt;&lt;a href=\""
                                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                                      . "?command=view&amp;req="
                                      . $request[0]
                                      . "\" target=\"req_bottom\"&gt;"
                                      . $request[0]
                                      . "&lt;/a&gt;&lt;/td&gt;\n";
                            } else {
                                    $contents .= "&lt;td align=right&gt;&lt;a href=\""
                                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                                      . "?command=view&amp;req="
                                      . $request[0]
                                      . "\" target=\"req_bottom\"&gt;"
                                      . $request[0]
                                      . "&lt;/a&gt;&lt;/td&gt;\n";
                            } ## end else
    
                            if ($request[1] eq "none") {
                                    $contents .=
                                      "&lt;td&gt;&lt;font color=red&gt;" . $request[1] . "&lt;/font&gt;&lt;/td&gt;\n";
                            } else {
                                    $contents .= "&lt;td&gt;" . $request[1] . "&lt;/td&gt;\n";
                            }
                            $age = <A HREF="#date_diff">date_diff</A>($request[2], time);
                            $contents .= "&lt;td&gt;" . $age . "&lt;/td&gt;\n";
                            $contents .= "&lt;td&gt;" . $request[3] . "&lt;/td&gt;\n";
                            $contents .= "&lt;td&gt;" . $request[4] . "&lt;/td&gt;\n";
                            # Handle non-english subject
                            $request[5] =~ s/(\?\=)\r?\n[\040\t]+(\=\?)/$1$2/sg;
                            $request[5] =~
    s/\=\?([\w\-]+)\?B\?([A-Za-z0-9\+\/]+\=*)\?\=/&amp;<A HREF="#un_base64">un_base64</A>($2,$1)/gex;
    
                            $contents .= "&lt;td&gt;" . $request[5] . "&lt;/td&gt;\n";
                            $contents .= "&lt;/tr&gt;\n";
                    } ## end while (&lt;INDEX&gt;)
                    $contents .= "&lt;/table&gt;\n&lt;/center&gt;\n";
            } ## end else
    
            # Make it refresh every 5 minutes
            $header = header(
                    -Refresh =&gt; '300; URL='
                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                      . '?command=<B>req_rescan</B>#Current',
                    -type =&gt; "text/html; charset=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CHARSET">CHARSET</A>'}
            );
            <A HREF="#print_page">print_page</A>("List Requests", $contents, $header);
    } ## end sub <B>req_rescan</B>    
</PRE>
<HR>

<H2><A NAME="display_buttons">reqtool/display_buttons</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_buttons</B> -- Display the command <A HREF="#buttons">buttons</A> frame
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>display_buttons</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Outputs the frame containing the command <A HREF="#buttons">buttons</A>
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to output HTML page of <A HREF="#buttons">buttons</A>
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_buttons</B> {
            my ($contents, $button);
    
            $contents = "&lt;center&gt;\n";
            foreach $button (@<A HREF="#button_order">button_order</A>) {
                    $contents .= "&lt;a href=\""
                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                      . "?command=req_"
                      . $button
                      . "\" target="
                      . $<A HREF="#buttons">buttons</A>{$button}[1]
                      . "&gt;&lt;img src=\""
                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                      . "?command=getimage&amp;image="
                      . $button
                      . "\" border=0 alt=\""
                      . $<A HREF="#buttons">buttons</A>{$button}[0]
                      . "\"&gt;&lt;/a&gt;&lt;br&gt;\n";
            } ## end foreach $button (@button_order...
            $contents .= "&lt;/center&gt;\n";
    
            <A HREF="#print_page">print_page</A>("Commands", $contents);
    } ## end sub <B>display_buttons</B>    
</PRE>
<HR>

<H2><A NAME="display_frames">reqtool/display_frames</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_frames</B> -- Setup the site frames
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>display_frames</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Output to STDOUT the frameset
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   HTML describing frameset
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_frames</B> {
            print "Content-type: text/html\n\n";
            print "&lt;html&gt;\n";
            print "&lt;head&gt;&lt;title&gt;Reqtool for "
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LISTNAME">LISTNAME</A>'}
              . "&lt;/title&gt;&lt;/head&gt;\n"
              . "&lt;frameset rows=\"40%%,*\"&gt;\n"
              . "   &lt;frame name=req_top src=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=list\"&gt;\n"
              . "   &lt;frameset cols=\"125,*\"&gt;\n"
              . "           &lt;frame name=req_command src=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=<A HREF="#buttons">buttons</A>\"&gt;\n"
              . "           &lt;frameset rows=\"*,30\"&gt;\n"
              . "                   &lt;frame name=req_bottom src=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=blank\"&gt;\n"
              . "                   &lt;frame name=<A HREF="#req_status">req_status</A> src=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=<A HREF="#req_status">req_status</A>\"&gt;\n"
              . "           &lt;/frameset&gt;\n"
              . "   &lt;/frameset&gt;\n"
              . "&lt;/frameset&gt;\n"
              . "&lt;/html&gt;\n";
    } ## end sub <B>display_frames</B>    
</PRE>
<HR>

<H2><A NAME="display_login">reqtool/display_login</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_login</B> -- Request Login information
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>display_login</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Displays a login screen that varies depending on whether <A HREF="#LDAP">LDAP</A> will be used
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display login screen
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_login</B> {
            my ($contents);
    
            $contents = "&lt;center&gt;\n";
            if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}) {
                    $contents .= "&lt;h2&gt;To login enter your ldap login/password&lt;/h2&gt;&lt;br&gt;\n";
            } else {
                    $contents .= "&lt;h2&gt;To login enter your unix login/password&lt;/h2&gt;&lt;br&gt;\n";
            }
            $contents .= "&lt;/center&gt;\n";
            $contents .=
              "&lt;form action=\"" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . "\" method=post&gt;\n";
            $contents .= "&lt;center&gt;&lt;table&gt;\n";
            $contents .=
              "&lt;tr&gt;&lt;td&gt;Login:&lt;/td&gt;&lt;td&gt;&lt;input type=text size=10 name=login&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .=
    "&lt;tr&gt;&lt;td&gt;Password:&lt;/td&gt;&lt;td&gt;&lt;input type=password size=10 name=password&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .= "&lt;/table&gt;\n";
            $contents .= "&lt;input type=submit name=loginSubmit value=\"Login\"&gt;\n";
            $contents .= "&lt;/center&gt;\n";
            $contents .= "&lt;input type=hidden name=command value=login&gt;\n";
            $contents .= "&lt;/form&gt;\n";
            <A HREF="#print_page">print_page</A>("Login to Reqtool", $contents);
    } ## end sub <B>display_login</B>    
</PRE>
<HR>

<H2><A NAME="login_check">reqtool/login_check</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>login_check</B> -- Check login/password and act accordingly
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>login_check</B> ( $login, $password )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Check login/password with passwd/<A HREF="#LDAP">LDAP</A> and kickout or allow in
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $login    - login name
   $password - password
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#display_welcome">display_welcome</A> or kicks person away
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>login_check</B> {
            my ($login, $password) = @_;
            my ($passwd, $salt);
            if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}) {
                    my $<A HREF="#LDAP">LDAP</A> = Net::<A HREF="#LDAP">LDAP</A>-&gt;new(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_SERVER">LDAP_SERVER</A>'}) || die "$@";
                    my $mesg =
                      $<A HREF="#LDAP">LDAP</A>-&gt;bind("uid=" . $login . ", " . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BIND">LDAP_BIND</A>'},
                            password =&gt; $password);
                    if ($mesg-&gt;code) {
                            <A HREF="#print_error">print_error</A>("Your Password/Login was incorrect");
                    } else {
                            $mesg = $<A HREF="#LDAP">LDAP</A>-&gt;search(
                                    base   =&gt; %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BASE">LDAP_BASE</A>'},
                                    attrs  =&gt; ['cn'],
                                    filter =&gt; "(uid=" . $login . ")"
                            );
                            <A HREF="#display_welcome">display_welcome</A>($login, $mesg-&gt;entry(0)-&gt;get_value("cn"));
                    } ## end else
                    $<A HREF="#LDAP">LDAP</A>-&gt;unbind;
            } else {
                    (undef, $passwd, undef) = getpwnam($login);
                    if ($passwd) {
                            $salt = $passwd;
                            $salt =~ s/(..).*/$1/g;
                            if (crypt($password, $salt) eq $passwd) {
    
                                    #you're in
                                    <A HREF="#display_welcome">display_welcome</A>($login, $login);
                            } else {
                                    <A HREF="#print_error">print_error</A>("Your Password/Login was incorrect");
                            }
                    } else {
                            <A HREF="#print_error">print_error</A>("Your Password/Login was incorrect");
    
                    }
            } ## end else
    } ## end sub <B>login_check</B>    
</PRE>
<HR>

<H2><A NAME="display_welcome">reqtool/display_welcome</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_welcome</B> -- Display the welcome screen
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>display_welcome</B> ( $login, $name )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Temporary screen to welcome user and set required cookie
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $login - login name
   $name  - full name
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display HTML
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_welcome</B> {
            my ($login, $name) = @_;
            my ($contents, $cookie, $cookie2, $header);
    
            $contents =
              "&lt;center&gt;&lt;h1&gt;Welcome " . $name . " to Reqtool&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;\n";
            $contents .=
    "&lt;center&gt;&lt;h2&gt;The main screen will now load automatically&lt;/h2&gt;&lt;/center&gt;&lt;br&gt;\n";
            $contents .= "&lt;center&gt;&lt;h2&gt;Click &lt;a href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "\"&gt;here&lt;/a&gt; to go to main screen if it doesn't&lt;/h2&gt;&lt;/center&gt;&lt;br&gt;\n";
            $cookie = new CGI::Cookie(
                    -name  =&gt; 'login',
                    -value =&gt; $login,
                    -path  =&gt; %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
            );
            $header = header(
                    -cookie  =&gt; $cookie,
                    -Refresh =&gt; '1; URL=' . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'},
                    -type    =&gt; "text/html; charset=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CHARSET">CHARSET</A>'}
            );
            <A HREF="#print_page">print_page</A>("Welcome to Reqtool", $contents, $header);
    } ## end sub <B>display_welcome</B>    
</PRE>
<HR>

<H2><A NAME="take_request">reqtool/take_request</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>take_request</B> --  Take a request
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>take_request</B> ( $req, $login )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Calls <A HREF="#req_give_do">req_give_do</A> to give request to caller
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req   - request number
   $login - callers name
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>take_request</B> {
            my ($req, $login) = @_;
            <A HREF="#req_give_do">req_give_do</A>($req, $login, $login);
    }    
</PRE>
<HR>

<H2><A NAME="req_give_do">reqtool/req_give_do</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_give_do</B> -- Give request to a person
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_give_do</B> -- ( $req, $username, $login )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Gives a request to a person, action by another
   (may be same, see <A HREF="#take_request">take_request</A>
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req      - request number
   $username - user to give to
   $login    - user given by
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display confirmation
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_give_do</B> {
            my ($req, $username, $login) = @_;
            my ($request_dir, $contents, @line);
    
            # Find fullname
            if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}) {
                    my $<A HREF="#LDAP">LDAP</A> = Net::<A HREF="#LDAP">LDAP</A>-&gt;new(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_SERVER">LDAP_SERVER</A>'}) || die "$@";
                    my $mesg = $<A HREF="#LDAP">LDAP</A>-&gt;bind(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BIND">LDAP_BIND</A>'});
                    $mesg = $<A HREF="#LDAP">LDAP</A>-&gt;search(
                            base   =&gt; %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BASE">LDAP_BASE</A>'},
                            attrs  =&gt; ['cn'],
                            filter =&gt; "(uid=" . $username . ")"
                    );
                    $username = $mesg-&gt;entry(0)-&gt;get_value("cn");
                    $mesg     = $<A HREF="#LDAP">LDAP</A>-&gt;search(
                            base   =&gt; %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BASE">LDAP_BASE</A>'},
                            attrs  =&gt; ['cn'],
                            filter =&gt; "(uid=" . $login . ")"
                    );
                    $login = $mesg-&gt;entry(0)-&gt;get_value("cn");
                    $<A HREF="#LDAP">LDAP</A>-&gt;unbind();
            } ## end if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}...
    
            $req         = <A HREF="#untaint_num">untaint_num</A>($req);
            
            # Add entry to request contents
            $request_dir = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/" . $req;
            open(REQTRACK, "&gt;&gt;$request_dir/request.contents")
              || <A HREF="#print_error">print_error</A>("Couldn't create $request_dir/request.contents");
            <A HREF="#lock_append">lock_append</A>(\*REQTRACK);
            print REQTRACK "-- New Action --\n";
            print REQTRACK "Action: Give\n";
            print REQTRACK "Owner: " . $username . "\n";
            print REQTRACK "Giver: " . $login . "\n";
            print REQTRACK "Date: " . localtime(time) . "\n";
            print REQTRACK "-- End Action --\n";
            close REQTRACK;
    
            # Update index by moving to tmp file then writing to new file
            rename(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'}, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'} . "~")
              || <A HREF="#print_error">print_error</A> "Cannot rename: $!";
            open(IN, "&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'} . "~")
              || <A HREF="#print_error">print_error</A> "Cannot open: $!";
            <A HREF="#lock_read">lock_read</A>(\*IN);
            open(OUT, "&gt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'})
              || <A HREF="#print_error">print_error</A> "Cannot create: $!";
            <A HREF="#lock_append">lock_append</A>(\*OUT);
    
            while ($_ = &lt;IN&gt;) {
                    @line = split (/\|/, $_, 6);
                    if ($line[0] == $req) {
                            print OUT $line[0] . "|"
                              . $username . "|"
                              . $line[2] . "|"
                              . $line[3] . "|"
                              . $line[4] . "|"
                              . $line[5];
                    } else {
                            print OUT $_;
                    }
            } ## end while ($_ = &lt;IN&gt;)
            close OUT;
            close IN;
    
            # Output result of action to user
            $contents =
              "Request &lt;font color=blue&gt;" . $req
              . "&lt;/font&gt; Given to &lt;font color=blue&gt;"
              . $username
              . "&lt;/font&gt; by &lt;font color=blue&gt;"
              . $login
              . "&lt;/font&gt;";
            $contents .= "&lt;script&gt;\n";
            $contents .= "top.req_top.location.href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=<A HREF="#req_rescan">req_rescan</A>#Current\"\n";
            $contents .= "top.req_bottom.location.reload()\n";
            $contents .= "&lt;/script&gt;\n";
            <A HREF="#print_page">print_page</A>("Request Status", $contents);
    } ## end sub <B>req_give_do</B>    
</PRE>
<HR>

<H2><A NAME="req_give">reqtool/req_give</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_give</B> -- Ask the user who to give request to
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_give</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Displays a page to check who you want to give request to
   List created from valid users file
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display combobox to choose user
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_give</B> {
            my ($contents, $username, $fullname);
    
            $contents = "&lt;center&gt;&lt;h1&gt;Give Request&lt;/h1&gt;&lt;br&gt;\n";
            $contents .= "&lt;form action=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "\" method=post target=<A HREF="#req_status">req_status</A>&gt;\n";
            $contents .= "&lt;h2&gt;Who do you want to give it to?&lt;/h2&gt;&lt;br&gt;\n";
            $contents .= "&lt;select name=username&gt;&lt;br&gt;\n";
    
            open(USERS, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#VALID_USERS">VALID_USERS</A>'}) || <A HREF="#print_error">print_error</A>("No valid users");
            <A HREF="#lock_read">lock_read</A>(\*USERS);
    
            my $<A HREF="#LDAP">LDAP</A>;
            if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}) {
                    $<A HREF="#LDAP">LDAP</A> = Net::<A HREF="#LDAP">LDAP</A>-&gt;new(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_SERVER">LDAP_SERVER</A>'}) || die "$@";
            }
    
            # Read list of valid users and convert login to fullname
            while ($_ = &lt;USERS&gt;) {
                    chomp($username = $_);
                    $username =~ s///g;
                    if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}) {
                            my $mesg = $<A HREF="#LDAP">LDAP</A>-&gt;search(
                                    base   =&gt; %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BASE">LDAP_BASE</A>'},
                                    attrs  =&gt; ['cn'],
                                    filter =&gt; "(uid=" . $username . ")"
                            );
                            $fullname = $mesg-&gt;entry(0)-&gt;get_value("cn");
                    } else {
                            (undef, undef, undef, undef, undef, undef, $fullname) =
                              getpwnam($username);
                            if (!($fullname)) { $fullname = $username; }
                    }
                    $contents .= "&lt;option value=\"" . $username . "\"&gt;" . $fullname . "\n";
            } ## end while ($_ = &lt;USERS&gt;)
            if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}) {
                    $<A HREF="#LDAP">LDAP</A>-&gt;unbind();
            }
            close USERS;
    
            $contents .= "&lt;/select&gt;&lt;br&gt;\n";
            $contents .= "&lt;input type=submit value=Give&gt;&lt;br&gt;\n";
            $contents .= "&lt;input type=hidden name=command value=<A HREF="#req_give_do">req_give_do</A>&gt;";
    
            <A HREF="#print_page">print_page</A>("Give Request", $contents);
    } ## end sub <B>req_give</B>    
</PRE>
<HR>

<H2><A NAME="req_comments">reqtool/req_comments</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_comments</B> -- Get user comments
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_comments</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Display a page requesting comments to add to request
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to output HTML form
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_comments</B> {
            my ($contents);
    
            $contents = "&lt;center&gt;&lt;h1&gt;Comments&lt;/h1&gt;\n";
            $contents .= "&lt;form action=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "\" method=post target=<A HREF="#req_status">req_status</A>&gt;\n";
            $contents .= "&lt;textarea cols=80 rows=10 name=comments&gt;&lt;/textarea&gt;&lt;br&gt;\n";
            $contents .= "&lt;input type=submit value=\"Add Comments\"&gt;";
            $contents .= "&lt;input type=hidden name=command value=<A HREF="#req_comments_do">req_comments_do</A>&gt;";
    
            <A HREF="#print_page">print_page</A>("Add Comments", $contents);
    } ## end sub <B>req_comments</B>    
</PRE>
<HR>

<H2><A NAME="req_comments_do">reqtool/req_comments_do</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_comments_do</B> -- Add the comments to a request
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_comments_do</B> ( $req, $login, $comments, $fullname )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   After receiving comments to add, actually add them to the request
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req      - request number
   $login    - login name
   $comments - comments to add
   $fullname - fullname of user adding comments
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_comments_do</B> {
            my ($req, $login, $comments, $fullname) = @_;
            my ($request_dir, $contents);
    
            $req         = <A HREF="#untaint_num">untaint_num</A>($req);
            $request_dir = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/" . $req;
            open(REQTRACK, "&gt;&gt;$request_dir/request.contents")
              || <A HREF="#print_error">print_error</A>("Couldn't add comments");
            <A HREF="#lock_append">lock_append</A>(\*REQTRACK);
            print REQTRACK "-- New Action --\n";
            print REQTRACK "Action: Comments\n";
            print REQTRACK "Date: " . localtime(time) . "\n";
    
            if (($fullname) &amp;&amp; ($fullname ne "")) {
                    print REQTRACK "Action-By: " . $fullname . "\n";
            } else {
                    print REQTRACK "Action-By: " . $login . "\n";
            }
            print REQTRACK $comments . "\n";
            print REQTRACK "-- End Action --\n";
            close REQTRACK;
    
            $contents = "&lt;script&gt;\n";
            $contents .= "top.req_top.location.href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=<A HREF="#req_rescan">req_rescan</A>#Current\"\n";
            $contents .= "top.req_bottom.location.href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=view&amp;req="
              . $req . "\"\n";
            $contents .= "&lt;/script&gt;\n";
            $contents .= "Comments Added";
            <A HREF="#print_page">print_page</A>("Comments sent", $contents);
    } ## end sub <B>req_comments_do</B>    
</PRE>
<HR>

<H2><A NAME="req_mail_do">reqtool/req_mail_do</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_mail_do</B> -- Send email
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_mail_do</B> ( $req, $login, $address, $cc, $subject,
                 $mail, $filename, $tmpfile, $type, $encoding )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Send email to recipents as described in parameters
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req      - request number
   $login    - login name
   $address  - email to send to
   $cc       - anyone to cc
   $subject  - subject of email
   $mail     - text of email
   $filename - sent filename of any attachment
   $tmpfile  - where the file is now
   $type     - what type of file is it
   $encoding - how is the file encoded
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Email sent via sendmail, HTML displayed via <A HREF="#print_page">print_page</A>
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_mail_do</B> {
            my (
                    $req,  $login,    $address, $cc,   $subject,
                    $mail, $filename, $tmpfile, $type, $encoding
              ) = @_;
            my ($from, $top, $fullname, $contents);
    
            # If this is not a new request then automagically set subject
            # This is not needed anymore
            #if ($req ne "0") {
            #       $subject =
            #         "[ " . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LISTNAME">LISTNAME</A>'} . " #" . $req . " ] " . $subject;
            #}
    
            # Get fullname and email from <A HREF="#LDAP">LDAP</A> if available
            # Otherwise use email as login@hostname
            if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}) {
                    my $<A HREF="#LDAP">LDAP</A> = Net::<A HREF="#LDAP">LDAP</A>-&gt;new(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_SERVER">LDAP_SERVER</A>'}) || <A HREF="#print_error">print_error</A>($@);
                    my $mesg = $<A HREF="#LDAP">LDAP</A>-&gt;bind(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BIND">LDAP_BIND</A>'});
                    $mesg = $<A HREF="#LDAP">LDAP</A>-&gt;search(
                            base   =&gt; "ou=people, dc=sun, dc=com",
                            filter =&gt; "(employeenumber=" . $login . ")"
                    );
                    $<A HREF="#LDAP">LDAP</A>-&gt;unbind;
                    $from =
                      $mesg-&gt;entry(0)-&gt;get_value("cn") . " &lt;"
                      . $mesg-&gt;entry(0)-&gt;get_value("mail") . "&gt;";
            } else {
                    (undef, undef, undef, undef, undef, undef, $fullname) =
                      getpwnam($login);
                    $from = $fullname . " &lt;" . $login . "@" . hostname . "&gt;";
            }
    
            $top = MIME::Entity-&gt;build(
                    From       =&gt; $from,
                    To         =&gt; $address,
                    Cc         =&gt; $cc,
                    Subject    =&gt; $subject,
                    'Reply-To' =&gt; %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#MAILING_LIST">MAILING_LIST</A>'},
                    Data       =&gt; $mail
            );
    
            if ($tmpfile ne "") {
                    $top-&gt;attach(
                            Path     =&gt; $tmpfile,
                            Type     =&gt; $type,
                            Filename =&gt; $filename,
                            Encoding =&gt; $encoding
                    );
            } ## end if ($tmpfile ne "")
    
            # Pipe the email via sendmail to email it on
            open(SENDMAIL, "|/usr/lib/sendmail -oi -t")
              || <A HREF="#print_error">print_error</A>("Can't fork for sendmail: $!\n");
            $top-&gt;print(\*SENDMAIL);
            close(SENDMAIL) || warn("sendmail didn't close nicely");
    
            open(A, "&gt;/tmp/out");
            $top-&gt;print(\*A);
            close A;
            $contents = "&lt;script&gt;\n";
            $contents .= "top.req_top.location.href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=<A HREF="#req_rescan">req_rescan</A>#Current\"\n";
            $contents .= "&lt;/script&gt;\n";
            $contents .= "Mail sent";
            <A HREF="#print_page">print_page</A>("Mail sent", $contents);
    } ## end sub <B>req_mail_do</B>    
</PRE>
<HR>

<H2><A NAME="req_resolve">reqtool/req_resolve</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_resolve</B> -- Resolve a given request
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_resolve</B> ( $req, $login, $fullname )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Resolves a request by moving it to the resolved queue
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req      - request number
   $login    - login name
   $fullname - full name
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display status of resolve action
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_resolve</B> {
            my ($req, $login, $fullname) = @_;
            my ($request_dir, $contents, @line);
    
            # Don't allow this if user is read-only user
            if ($login ne %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#READ_USER">READ_USER</A>'}) {
                    $request_dir = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/" . $req;
    
                    # Check for existance of resolved directory, otherwire create it
                    if (!-e %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'}) {
                            mkdir(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'}, 0775);
                    }
    
                    # Make sure the directory is a valid path
                    if ($request_dir =~ /^([-\@\w.\/]+)$/) {
                            $request_dir = $1;
                    } else {
                            <A HREF="#print_error">print_error</A>("Bad path data");
                    }
    
                    # Add action to request contents
                    open(REQTRACK, "&gt;&gt;$request_dir/request.contents")
                      || <A HREF="#print_error">print_error</A>("Couldn't open request contents");
                    <A HREF="#lock_append">lock_append</A>(\*REQTRACK);
                    print REQTRACK "-- New Action --\n";
                    print REQTRACK "Action: Resolve\n";
                    print REQTRACK "Date: " . localtime(time) . "\n";
                    if (($fullname) &amp;&amp; ($fullname ne "")) {
                            print REQTRACK "Action-By: " . $fullname . "\n";
                    } else {
                            print REQTRACK "Action-By: " . $login . "\n";
                    }
                    print REQTRACK "-- End Action --\n";
                    close REQTRACK;
    
                    # Move the request to the resolved directory
                    system("mv " . $request_dir . " " . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'});
    
                    # Update active/resolved indexes
                    system("cp "
                              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'} . " "
                              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'}
                              . "~");
                    open(IN, "&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'} . "~")
                      || <A HREF="#print_error">print_error</A> "Cannot open: $!";
                    <A HREF="#lock_read">lock_read</A>(\*IN);
                    open(OUT, "+&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'})
                      || <A HREF="#print_error">print_error</A> "Cannot create: $!";
                    <A HREF="#lock_write">lock_write</A>(\*OUT);
                    open(RINDEX, "&gt;&gt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'})
                      || <A HREF="#print_error">print_error</A>("Couldn't open resolved index");
                    <A HREF="#lock_append">lock_append</A>(\*RINDEX);
    
                    while ($_ = &lt;IN&gt;) {
                            @line = split (/\|/, $_, 6);
                            if ($line[0] == $req) {
                                    if ($line[1] eq "none") {
                                            $line[1] = $login;
                                    }
                                    print RINDEX $line[0] . "R|"
                                      . $line[1] . "|"
                                      . $line[2]
                                      . "|resolved|"
                                      . $line[4] . "|"
                                      . $line[5];
                            } else {
                                    print OUT $_;
                            }
                    } ## end while ($_ = &lt;IN&gt;)
                    close RINDEX;
                    close OUT;
                    close IN;
                    unlink "%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'}~";
    
                    # Display results of action to user
                    if ($login eq "dropped") {
                            $contents = "&lt;script&gt;\n";
                            $contents .= "top.req_top.location.href=\""
                              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                              . "?command=<A HREF="#req_rescan">req_rescan</A>#Current\"\n";
                            $contents .= "top.req_bottom.location.reload()\n";
                            $contents .= "&lt;/script&gt;\n";
                            $contents .= "Request " . $req . " dropped";
    
                            <A HREF="#print_page">print_page</A>("Dropped", $contents);
                    } else {
                            $contents = "&lt;script&gt;\n";
                            $contents .= "top.req_top.location.href=\""
                              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                              . "?command=<A HREF="#req_rescan">req_rescan</A>#Current\"\n";
                            $contents .= "top.req_bottom.location.reload()\n";
                            $contents .= "&lt;/script&gt;\n";
                            $contents .= "Request &lt;font color=blue&gt;" . $req
                              . "&lt;/font&gt; resolved by "
                              . $login;
                            <A HREF="#print_page">print_page</A>("Resolved", $contents);
                    } ## end else
            } else {
                    <A HREF="#print_page">print_page</A>("Error", "Sorry you are not allowed to do this operation");
            }
    } ## end sub <B>req_resolve</B>    
</PRE>
<HR>

<H2><A NAME="req_search">reqtool/req_search</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_search</B> -- Display Search for a request screen
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_search</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Displays a form to allow user to search for a request
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display form
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_search</B> {
            my ($contents);
    
            $contents = "&lt;form action=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . " method=post&gt;\n";
            $contents .= "&lt;center&gt;&lt;h1&gt;Search for request&lt;/h1&gt;\n";
            $contents .= "&lt;b&gt;Search by&lt;/b&gt;\n";
            $contents .= "&lt;select name=searchby&gt;\n";
            $contents .= "&lt;option value=all&gt;All\n";
            $contents .= "&lt;option value=num&gt;Number\n";
            $contents .= "&lt;option value=subject&gt;Subject\n";
            $contents .= "&lt;option value=email&gt;eMail\n";
            $contents .= "&lt;/select&gt;\n";
            $contents .= "&lt;INPUT TYPE=checkbox NAME=active CHECKED&gt;active\n";
            $contents .= "&lt;INPUT TYPE=checkbox NAME=resolved CHECKED&gt;resolved&lt;br&gt;\n";
            $contents .= "&lt;b&gt;Search for&lt;/b&gt;\n";
            $contents .= "&lt;input type=text size=20 name=query&gt;&lt;br&gt;\n";
            $contents .= "&lt;input type=hidden name=command value=<A HREF="#req_search_do">req_search_do</A>&gt;\n";
            $contents .= "&lt;/form&gt;\n";
            <A HREF="#print_page">print_page</A>("Search", $contents);
    } ## end sub <B>req_search</B>    
</PRE>
<HR>

<H2><A NAME="req_search_do">reqtool/req_search_do</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_search_do</B> --  Search for a request and return results
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_search_do</B> ( $query, $searchby, $active, $resolved )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Search active/resolved queues for a request by calling <A HREF="#search_file">search_file</A>
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $query    - search term
   $searchby - what category to search by
   $active   - boolean saying whether to search active queue
   $resolved - boolean saying whether to search resolved queue
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display search results
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_search_do</B> {
            my ($query, $searchby, $active, $resolved) = @_;
            my ($contents, $results);
    
            $contents = "&lt;center&gt;\n&lt;table border=2 cellpadding=5&gt;\n";
            $contents .=
              "&lt;tr&gt;&lt;th colspan=6 bgcolor=#ffffcc&gt;Search for " . $query . " by "
              . $searchby
              . "&lt;/th&gt;&lt;/tr&gt;\n";
            $contents .=
    "&lt;tr bgcolor=#99ffcc&gt;&lt;td&gt;Request&lt;/td&gt;&lt;td&gt;Owner&lt;/td&gt;&lt;td&gt;Age&lt;/td&gt;&lt;td&gt;Status&lt;/td&gt;&lt;td&gt;From&lt;/td&gt;&lt;td&gt;Subject&lt;/td&gt;&lt;/tr&gt;\n";
    
            # Check wheter we are searching resolved requests only
            if ($active eq "resolved") {
                    undef $active;
                    $resolved = "on";
            }
    
            if ($active) {
                    $results = <A HREF="#search_file">search_file</A>(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'}, $query, $searchby);
                    if ($results) {
                            $contents .= $results;
                            $results = "";
                    }
            } ## end if ($active)
    
            if ($resolved) {
                    $results = <A HREF="#search_file">search_file</A>(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'}, $query, $searchby);
                    if ($results) {
                            $contents .= $results;
                            $results = "";
                    }
            } ## end if ($resolved)
    
            $contents .= "&lt;/table&gt;\n&lt;/center&gt;\n";
    
            <A HREF="#print_page">print_page</A>("Search", $contents);
    } ## end sub <B>req_search_do</B>    
</PRE>
<HR>

<H2><A NAME="admin_forward">reqtool/admin_forward</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>admin_forward</B> -- Edit forwards
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>admin_forward</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Displays a form that is used to edit the forwards
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display form
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>admin_forward</B> {
            my ($contents, $array_values, $count);
    
            $contents = "&lt;script language=\"JavaScript\"&gt;\n";
            $contents .= "&lt;!--\n";
    
            $array_values = "Forward[0] = \"\"\n";
            $array_values .= "ForwardEmail[0] = \"\"\n";
            $array_values .= "ForwardName[0] = new Option (\"Add New\",\"0\")\n";
            close REQTRACK;
    
            if (!open(FORWARD, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_FILE">FORWARD_FILE</A>'})) {
                    $count = 0;
            } else {
                    <A HREF="#lock_read">lock_read</A>(\*FORWARD);
                    $count = &lt;FORWARD&gt;;
                    chomp($count);
    
                    while (&lt;FORWARD&gt;) {
                            $array_values .= $_;
                    }
                    close FORWARD;
            } ## end else
    
            $contents .= "var Forward = new Array(" . $count . ")\n";
            $contents .= "var ForwardEmail = new Array(" . $count . ")\n";
            $contents .= "var ForwardName = new Array(" . $count . ")\n";
            $contents .= $array_values;
            $contents .= "function add_to_body() { // add selected contents to body\n";
            $contents .=
    "       document.email.current.value = document.email.addme.options[document.email.addme.selectedIndex].text\n";
            $contents .=
    "       document.email.mail.value = Forward[document.email.addme.options[document.email.addme.selectedIndex].value]\n";
            $contents .=
    "       document.email.address.value = ForwardEmail[document.email.addme.options[document.email.addme.selectedIndex].value]\n";
            $contents .= "}\n";
            $contents .= "\n";
            $contents .= "// --&gt;\n";
            $contents .= "&lt;/script&gt;\n";
            $contents .= "\n";
            $contents .= "\n";
            $contents .= "&lt;center&gt;&lt;form action="
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . " method=get name=email&gt;\n";
            $contents .= "&lt;table border=0 cols=3&gt;\n";
            $contents .=
    "&lt;tr&gt;&lt;td width=100&gt;&lt;b&gt;Send email to:&lt;/b&gt;&lt;/td&gt;&lt;td colspan=2&gt;&lt;input type=text name=address size=60&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .=
    "&lt;tr&gt;&lt;td colspan=3&gt;&lt;textarea cols=80 rows=20 name=mail&gt;&lt;/textarea&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .= "&lt;tr&gt;&lt;td&gt;&lt;input type=submit value=\"Update Files\"&gt;&lt;/td&gt;";
            $contents .= "&lt;td&gt;&lt;/td&gt;";
            $contents .=
    "&lt;td&gt;&lt;select name=addme onChange=\"javascript:add_to_body()\"&gt;&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .= "&lt;/table&gt;";
            $contents .= "&lt;input type=hidden name=command value=admin&gt;\n";
            $contents .= "&lt;input type=hidden name=admin value=<A HREF="#admin_forward_do">admin_forward_do</A>&gt;\n";
            $contents .= "&lt;input type=hidden name=current value=\"Add New\"&gt;\n";
            $contents .= "&lt;/form&gt;&lt;/center&gt;\n";
            $contents .= "\n";
            $contents .= "&lt;script language=\"JavaScript\"&gt;\n";
            $contents .= "&lt;!--\n";
            $contents .= "for (var i=0; i &lt;= " . $count . " ; i++) {\n";
            $contents .= "  document.email.addme.options[i]=ForwardName[i]\n";
            $contents .= "  document.email.addme.selectedIndex=0\n";
            $contents .= "}\n";
            $contents .= "// --&gt;\n";
            $contents .= "&lt;/script&gt;\n";
    
            <A HREF="#print_page">print_page</A>("Admin - Update Forwards", $contents);
    } ## end sub <B>admin_forward</B>    
</PRE>
<HR>

<H2><A NAME="admin_forward_do">reqtool/admin_forward_do</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>admin_forward_do</B> -- Update a forward
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>admin_forward_do</B> ( $address, $body, $option )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Update the forward file with data given
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $address - email address of forward
   $body    - text of forward
   $option  - option number of forward
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display result of update
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>admin_forward_do</B> {
            my ($address, $body, $option) = @_;
            my ($contents, $count, $output, $forward, $email);
    
            if ($option eq "Add New") {
                    $contents =
                      "&lt;form action=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . " method=post&gt;\n";
                    $contents .=
    "&lt;b&gt;Enter Forward name&lt;/b&gt;&lt;input type=text name=current size=20&gt;&lt;br&gt;\n";
                    $contents .=
                      "&lt;b&gt;Address&lt;/b&gt;&lt;input type=text name=address value=\"" . $address
                      . "\"&gt;&lt;br&gt;\n";
                    $contents .=
                      "&lt;textarea name=mail rows=10 cols=80&gt;" . $body . "&lt;/textarea&gt;&lt;br&gt;\n";
                    $contents .= "&lt;input type=submit value=\"Submit New Forward\"&gt;\n";
                    $contents .= "&lt;input type=hidden name=command value=admin&gt;\n";
                    $contents .= "&lt;input type=hidden name=admin value=<B>admin_forward_do</B>&gt;\n";
                    $contents .= "&lt;/form&gt;\n";
                    <A HREF="#print_page">print_page</A>("Add new forward", $contents);
            } else {
    
                    # If no forward dir exists then create it
                    if (!-e %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_DIR">FORWARD_DIR</A>'}) {
                            mkdir(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_DIR">FORWARD_DIR</A>'}, 0775);
                    }
                    if ($option =~ /(.*)/) {
                            $option = $1;
                    } else {
                            <A HREF="#print_error">print_error</A>("No name given");
                    }
    
                    # Create forward option
                    open(FORWARD, "&gt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_DIR">FORWARD_DIR</A>'} . "/" . $option)
                      || <A HREF="#print_error">print_error</A>("Couldn't create $option: $!");
                    <A HREF="#lock_append">lock_append</A>(\*FORWARD);
                    print FORWARD $address . "\n";
                    chomp $body;
                    $body =~ s///g;
                    print FORWARD $body . "\n";
                    close FORWARD;
    
                    opendir(DIR, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_DIR">FORWARD_DIR</A>'})
                      || <A HREF="#print_error">print_error</A>("can't opendir " . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_DIR">FORWARD_DIR</A>'} . ": $!");
                    if (!open(FORWARD, "+&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_FILE">FORWARD_FILE</A>'})) {
                            open(FORWARD, "&gt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_FILE">FORWARD_FILE</A>'});
                            <A HREF="#lock_append">lock_append</A>(\*FORWARD);
                    } else {
                            <A HREF="#lock_write">lock_write</A>(\*FORWARD);
                    }
                    $count  = 0;
                    $output = "";
    
                    # Rebuild forward html from directory contents
                    while ($forward = readdir(DIR)) {
                            if ($forward =~ /^\./) {
                                    # ignore this as it is hidden file
                            } else {
                                    $count++;
                                    open(FILE, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_DIR">FORWARD_DIR</A>'} . "/" . $forward)
                                      || <A HREF="#print_error">print_error</A>("permission denied");
                                    <A HREF="#lock_read">lock_read</A>(\*FILE);
                                    $output .= "ForwardName[" . $count
                                      . "] = new Option(\""
                                      . $forward . "\",\""
                                      . $count . "\")\n";
                                    $output .= "ForwardEmail[" . $count . "] = \"";
                                    $email = &lt;FILE&gt;;
                                    chomp($email);
                                    $output .= $email . "\"\n";
                                    $output .= "Forward[" . $count . "] = \"";
    
                                    while (&lt;FILE&gt;) {
                                            chomp;
                                            $_ =~ s/\"/\\\"/g;
                                            $output .= $_ . "\\n";
                                    }
                                    $output .= "\"\n";
                                    close FILE;
                            } ## end else
                    } ## end while ($forward = readdir...
                    print FORWARD $count . "\n";
                    print FORWARD $output;
                    close FORWARD;
                    close DIR;
    
                    # Return results to administrator
                    $contents = "&lt;center&gt;&lt;h1&gt;Forward updated/Added&lt;/h1&gt;&lt;/center&gt;\n";
                    $contents .= "&lt;table border=1&gt;\n";
                    $contents .=
                      "&lt;tr&gt;&lt;td&gt;&lt;b&gt;Forward name:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;" . $option . "&lt;/td&gt;&lt;/tr&gt;\n";
                    $contents .=
                      "&lt;tr&gt;&lt;td&gt;&lt;b&gt;Address:&lt;/b&gt;&lt;/td&gt;&lt;td&gt;" . $address . "&lt;/td&gt;&lt;/tr&gt;\n";
                    $contents .= "&lt;tr&gt;&lt;td colspan=2&gt;&lt;pre wrap&gt;" . $body . "&lt;/pre&gt;&lt;/td&gt;\n";
                    $contents .= "&lt;/table&gt;\n";
                    $contents .= "&lt;h2&gt;Return to &lt;a href=\""
                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                      . "?command=admin\"&gt;Menu&lt;/a&gt;&lt;h2&gt;\n";
                    <A HREF="#print_page">print_page</A>("Added forward", $contents);
            } ## end else
    } ## end sub <B>admin_forward_do</B>    
</PRE>
<HR>

<H2><A NAME="req_mail">reqtool/req_mail</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_mail</B> -- Send an email via <A HREF="#reqtool">reqtool</A>
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_mail</B> ( $req )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Displays a form to allow sending of an email
   Automatically fills some fields in from given request
   Can add attachment
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req - request number ( 0 if new email )
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display form
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_mail</B> {
            my ($req) = @_;
            my (
                    $contents, $request_dir, $array_values,
                    @line,     $from,        $path,
                    $body,     $text,        $count
            );
            my $subject = "";
            $contents = "&lt;script language=\"JavaScript\"&gt;\n";
            $contents .= "&lt;!--\n";
    
            # Load request for automatic creation of forward
            if ($req =~ /R/) {
                    $req =~ s/^(.*)R$/$1/g;
                    $request_dir = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'} . "/" . $req;
            } else {
                    $request_dir = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/" . $req;
            }
            if ($req &gt; 0) {
                    open(REQTRACK, "$request_dir/request.contents")
                      || <A HREF="#print_error">print_error</A>("Couldn't open $request_dir/request.contents");
                    <A HREF="#lock_read">lock_read</A>(\*REQTRACK);
    
                    $array_values .= "Forward[0] = \"\\n--- Message Included ---\\n";
    
                    while (&lt;REQTRACK&gt;) {
                            chomp;
                            if ((/^To: /) || (/^From: /) || (/^Subject: /) || (/^Cc: /)) {
                                    $_ =~ s/\"/\\\"/g;
                                    $array_values .= $_ . "\\n";
    
                                    if (/^From: /) {
                                            @line = split (/: /, $_, 2);
                                            $from = $line[1];
                                    } elsif (/^Subject: /) {
                                            @line = split (/: /, $_, 2);
                                            $subject = "[ ".%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LISTNAME">LISTNAME</A>'}." #".$req." ] ".$line[1];
                                    }
                            } elsif (/^Path: /) {
                                    @line = split (/: /, $_, 2);
                                    $path = $line[1];
                            } elsif (/^Body: /) {
                                    @line = split (/: /, $_, 2);
                                    $body = $line[1];
                                    open(BODY, "$request_dir/$path/$body")
                                      || <A HREF="#print_error">print_error</A>("can't open body");
                                    <A HREF="#lock_read">lock_read</A>(\*BODY);
    
                                    while (&lt;BODY&gt;) {
                                            chomp;
                                            $text = $_;
                                            $text =~ s/\"/\\\"/g;
                                            $text =~ s/$/\\n/g;
                                            $array_values .= $text;
                                    } ## end while (&lt;BODY&gt;)
                                    close BODY;
                                    last;
                            } ## end elsif (/^Body: /)
                    } ## end while (&lt;REQTRACK&gt;)
                    $array_values .= "\"\n";
                    $array_values .= "ForwardEmail[0] = \"" . $from . "\"\n";
                    $array_values .=
                      "ForwardName[0] = new Option(\"Message Body\",\"0\")\n";
                    close REQTRACK;
            } ## end if ($req &gt; 0)
    
            # Add pre-defined forwards
            open(FORWARD, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_FILE">FORWARD_FILE</A>'})
              || <A HREF="#print_error">print_error</A>("couldn't open " . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_FILE">FORWARD_FILE</A>'});
            <A HREF="#lock_read">lock_read</A>(\*FORWARD);
            $count = &lt;FORWARD&gt;;
            chomp($count);
    
            while (&lt;FORWARD&gt;) {
                    $array_values .= $_;
            }
            close FORWARD;
    
            # HTML source from here on
            $contents .= "var Forward = new Array(" . $count . ")\n";
            $contents .= "var ForwardEmail = new Array(" . $count . ")\n";
            $contents .= "var ForwardName = new Array(" . $count . ")\n";
            $contents .= $array_values;
            $contents .= "function add_to_body() { // add selected contents to body\n";
            $contents .=
    "       document.email.mail.value = document.email.mail.value + Forward[document.email.addme.options[document.email.addme.selectedIndex].value]\n";
            $contents .= "  if (document.email.address.value == \"\") {\n";
            $contents .=
    "               document.email.address.value = document.email.address.value + ForwardEmail[document.email.addme.options[document.email.addme.selectedIndex].value]\n";
            $contents .= "  } else {\n";
            $contents .=
    "               document.email.address.value = document.email.address.value + \", \" + ForwardEmail[document.email.addme.options[document.email.addme.selectedIndex].value]\n";
            $contents .= "  }\n";
            $contents .= "}\n";
            $contents .= "\n";
            $contents .= "// --&gt;\n";
            $contents .= "&lt;/script&gt;\n";
            $contents .= "\n";
            $contents .= "\n";
            $contents .= "&lt;center&gt;&lt;form action="
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . " method=post name=email enctype=\"multipart/form-data\" target=<A HREF="#req_status">req_status</A>&gt;\n";
            $contents .= "&lt;table border=0 cols=3&gt;\n";
            $contents .=
    "&lt;tr&gt;&lt;td width=100&gt;To:&lt;/td&gt;&lt;td colspan=2&gt;&lt;input type=text name=address size=60&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .=
              "&lt;tr&gt;&lt;td&gt;Cc:&lt;/td&gt;&lt;td colspan=2&gt;&lt;input type=text name=cc value=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#MAILING_LIST">MAILING_LIST</A>'}
              . "\" size=60&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .=
    "&lt;tr&gt;&lt;td&gt;Subject:&lt;/td&gt;&lt;td colspan=2&gt;&lt;input type=text name=subject size=60 value=\""
              . $subject
              . "\"&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .=
    "&lt;tr&gt;&lt;td&gt;Attachment:&lt;/td&gt;&lt;td colspan=2&gt;&lt;input type=file name=attach size=50&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .=
    "&lt;tr&gt;&lt;td colspan=3&gt;&lt;textarea cols=80 rows=5 name=mail&gt;&lt;/textarea&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .= "&lt;tr&gt;&lt;td&gt;&lt;input type=submit value=\"Send Email\"&gt;&lt;/td&gt;";
            $contents .=
    "&lt;td align=right valign=top&gt;&lt;input type=button name=contents value=\"Add to message body\" onClick=\"javascript:add_to_body()\"&gt;&lt;/td&gt;";
            $contents .=
    "&lt;td align=left valign=top&gt;&lt;select name=addme&gt;&lt;/select&gt;Resolve&lt;input type=checkbox name=resolve value=Resolve&gt;&lt;/td&gt;&lt;/tr&gt;\n";
            $contents .= "&lt;/table&gt;";
            $contents .= "&lt;input type=hidden name=command value=<A HREF="#req_mail_do">req_mail_do</A>&gt;\n";
            $contents .= "&lt;/form&gt;&lt;/center&gt;\n";
            $contents .= "\n";
            $contents .= "&lt;script language=\"JavaScript\"&gt;\n";
            $contents .= "&lt;!--\n";
            $contents .= "for (var i=0; i &lt;= " . $count . " ; i++) {\n";
            $contents .= "  document.email.addme.options[i]=ForwardName[i]\n";
            $contents .= "  document.email.addme.selectedIndex=0\n";
            $contents .= "}\n";
            $contents .= "// --&gt;\n";
            $contents .= "&lt;/script&gt;\n";
    
            <A HREF="#print_page">print_page</A>("Get Email", $contents);
    } ## end sub <B>req_mail</B>    
</PRE>
<HR>

<H2><A NAME="search_file">reqtool/search_file</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>search_file</B> -- search a given file regarding query
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $contents = <B>search_file</B> ( $file, $query, $searchby )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Search the index for requests matching the query
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $file     - index file
   $query    - query text
   $searchby - fields to search by
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $contents - HTML source describing results
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>search_file</B> {
            my ($file, $query, $searchby) = @_;
            my ($req, @request, $contents, $age);
    
            # Open the file we need to search and then search with reference
            # to the fields that have been requested
            open(FILE, $file) || return 0;
            <A HREF="#lock_read">lock_read</A>(\*FILE);
    
            while (&lt;FILE&gt;) {
                    $req = 0;
                    @request = split (/\|/, $_, 6);
                    if ($searchby =~ /num/) {
                            if (($request[0] eq $query) || ($request[0] eq $query . "R")) {
                                    $req = $request[0];
                            }
                    } elsif ($searchby =~ /subject/) {
                            if ($request[5] =~ /$query/i) {
                                    $req = $request[0];
                            }
                    } elsif ($searchby =~ /email/) {
                            if ($request[4] =~ /$query/i) {
                                    $req = $request[0];
                            }
                    } else {
                            if (/$query/i) {
                                    $req = $request[0];
                            }
                    }
    
                    # This request matches search criteria so display it
                    if ($req) {
                            $contents .= "&lt;tr&gt;\n";
                            $contents .= "&lt;td align=right&gt;&lt;a href=\""
                              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
                              . "?command=view&amp;req="
                              . $request[0]
                              . "\" target=\"req_bottom\"&gt;"
                              . $request[0]
                              . "&lt;/td&gt;\n";
                            $contents .= "&lt;td&gt;" . $request[1] . "&lt;/td&gt;\n";
                            $age = <A HREF="#date_diff">date_diff</A>($request[2], time);
                            $contents .= "&lt;td&gt;" . $age . "&lt;/td&gt;\n";
                            $contents .= "&lt;td&gt;" . $request[3] . "&lt;/td&gt;\n";
                            $contents .= "&lt;td&gt;" . $request[4] . "&lt;/td&gt;\n";
                            $contents .= "&lt;td&gt;" . $request[5] . "&lt;/td&gt;\n";
                            $contents .= "&lt;/tr&gt;\n";
                    } ## end if ($req)
            } ## end while (&lt;FILE&gt;)
            return $contents;
    } ## end sub <B>search_file</B>    
</PRE>
<HR>

<H2><A NAME="req_parameters">reqtool/req_parameters</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_parameters</B> -- Login for Administration section
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_parameters</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Displays login screen for administration section
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display login screen
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_parameters</B> {
            my ($contents);
    
            $contents = "&lt;form action=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . " method=post&gt;\n";
            $contents .= "&lt;center&gt;&lt;h1&gt;Login to Administration section&lt;/h1&gt;&lt;br&gt;\n";
            $contents .=
              "&lt;b&gt;Administrator Password&lt;/b&gt;&lt;input type=password name=password&gt;&lt;br&gt;\n";
            $contents .= "&lt;input type=hidden name=command value=admin&gt;\n";
            $contents .= "&lt;input type=hidden name=admin value=main&gt;\n";
            $contents .= "&lt;/form&gt;&lt;/center&gt;\n";
    
            <A HREF="#print_page">print_page</A>("Login Admin", $contents);
    } ## end sub <B>req_parameters</B>    
</PRE>
<HR>

<H2><A NAME="admin_main">reqtool/admin_main</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>admin_main</B> -- Main administration menu/screen
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>admin_main</B> ( $password )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Displays admin menu and sets cookie saying you're allowed here
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $password
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display menu and set cookie
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>admin_main</B> {
            my ($password) = @_;
            my ($contents, $cookie, $header);
    
            $contents = "&lt;center&gt;&lt;h1&gt;Reqtool Administration&lt;/h1&gt;&lt;br&gt;\n";
            $contents .= "&lt;h2&gt;Choose your options&lt;/h2&gt;&lt;br&gt;\n";
            $contents .= "&lt;form action=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . " method=post&gt;\n";
            $contents .=
    "&lt;input type=hidden name=command value=admin&gt;&lt;input type=hidden name=admin value=<A HREF="#admin_forward">admin_forward</A>&gt;\n";
            $contents .= "&lt;input type=submit value=\"Update/Add Forward\"&gt;\n";
            $contents .= "&lt;/form&gt;\n";
            $contents .= "&lt;form action=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . " method=post&gt;\n";
            $contents .=
    "&lt;input type=hidden name=command value=admin&gt;&lt;input type=hidden name=admin value=<A HREF="#admin_users">admin_users</A>&gt;\n";
            $contents .= "&lt;input type=submit value=\"Update users\"&gt;\n";
            $contents .= "&lt;/form&gt;\n";
            $contents .= "&lt;form action=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . " method=post&gt;\n";
            $contents .=
    "&lt;input type=hidden name=command value=admin&gt;&lt;input type=hidden name=admin value=admin_index&gt;\n";
            $contents .= "&lt;input type=submit value=\"Refresh index\"&gt;\n";
            $contents .= "&lt;/form&gt;\n";
    
            $cookie = new CGI::Cookie(
                    -name   =&gt; 'admin',
                    -value  =&gt; $password,
                    -path   =&gt; %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'},
                    expires =&gt; '+3h'
            );
            $header = header(
                    -cookie =&gt; $cookie,
                    -type   =&gt; "text/html; charset=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CHARSET">CHARSET</A>'}
            );
    
            <A HREF="#print_page">print_page</A>("Administator Section", $contents, $header);
    } ## end sub <B>admin_main</B>    
</PRE>
<HR>

<H2><A NAME="admin_users">reqtool/admin_users</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>admin_users</B> -- Edit valid users
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>admin_users</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Form to edit who is allowed to own requests
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display form
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>admin_users</B> {
            my ($contents);
    
            $contents = "&lt;center&gt;&lt;h1&gt;Update Valid Users&lt;/h1&gt;&lt;br&gt;\n";
            $contents .= "&lt;form action=" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . " method=post&gt;\n";
            $contents .= "&lt;textarea cols=40 rows=10 name=users&gt;";
            if (open(USERS, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#VALID_USERS">VALID_USERS</A>'})) {
                    <A HREF="#lock_read">lock_read</A>(\*USERS);
    
                    while (&lt;USERS&gt;) {
                            $contents .= $_;
                    }
                    close USERS;
            } ## end if (open(USERS, %<A HREF="#qconfig">qconfig</A>...
            $contents .= "&lt;/textarea&gt;&lt;br&gt;\n";
            $contents .= "&lt;input type=submit value=\"Submit Changes\"&gt;\n";
            $contents .= "&lt;input type=hidden name=command value=admin&gt;\n";
            $contents .= "&lt;input type=hidden name=admin value=<A HREF="#admin_users_do">admin_users_do</A>&gt;\n";
            $contents .= "&lt;/form&gt;\n";
    
            <A HREF="#print_page">print_page</A>("Update Valid Users", $contents);
    } ## end sub <B>admin_users</B>    
</PRE>
<HR>

<H2><A NAME="admin_users_do">reqtool/admin_users_do</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>admin_users_do</B> -- Update the valid users file
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>admin_users_do</B> ( $users )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Update <A HREF="#VALID_USERS">VALID_USERS</A> to value given from <A HREF="#admin_users">admin_users</A> screen
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $users - list of valid users
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display status of action
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>admin_users_do</B> {
            my ($users) = @_;
            my ($contents);
    
            if (!open(USERS, "+&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#VALID_USERS">VALID_USERS</A>'})) {
                    open(USERS, "&gt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#VALID_USERS">VALID_USERS</A>'})
                      || <A HREF="#print_error">print_error</A>("Can't open %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#VALID_USERS">VALID_USERS</A>'}: $!");
                    <A HREF="#lock_append">lock_append</A>(\*USERS);
    
            } else {
                    <A HREF="#lock_write">lock_write</A>(\*USERS);
            }
            $users =~ s/ /\n/g;
            $users =~ s/,/\n/g;
            $users =~ s/^$//g;
            print USERS $users;
            close USERS;
    
            $contents = "&lt;center&gt;&lt;h1&gt;Updated Valid-Users&lt;/h1&gt;&lt;/center&gt;\n";
            $contents .= "&lt;h2&gt;Return to &lt;a href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=admin\"&gt;Menu&lt;/a&gt;&lt;h2&gt;\n";
            <A HREF="#print_page">print_page</A>("Updated Users", $contents);
    } ## end sub <B>admin_users_do</B>    
</PRE>
<HR>

<H2><A NAME="req_merge">reqtool/req_merge</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_merge</B> -- Merge two requests
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_merge</B> ( $req )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Ask user which two requests to merge
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req - initial request number
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display result
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_merge</B> {
            my ($req) = @_;
            my ($contents, $requests, @line);
    
            # Open the active index to find available requests
            # Current request is automatically selected
            open(INDEX, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'})
              || <A HREF="#print_error">print_error</A>("Couldn't open active index: $!");
            <A HREF="#lock_read">lock_read</A>(\*INDEX);
            $requests = "";
            while (&lt;INDEX&gt;) {
                    @line = split (/\|/, $_, 6);
    
                    if ($line[0] == $req) {
                            $requests .= "&lt;option value=\""
                              . $line[0]
                              . "\" selected&gt;"
                              . $line[0] . " - "
                              . $line[5] . "\n";
                    } else {
                            $requests .= "&lt;option value=\""
                              . $line[0] . "\"&gt;"
                              . $line[0] . " - "
                              . $line[5] . "\n";
                    } ## end else
            } ## end while (&lt;INDEX&gt;)
            close INDEX;
    
            $contents = "&lt;center&gt;&lt;h1&gt;Merge Requests&lt;/h1&gt;&lt;/center&gt;&lt;br&gt;\n";
            $contents .=
              "&lt;form action=\"" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . "\" target=<A HREF="#req_status">req_status</A>&gt;\n";
            $contents .= "&lt;input type=hidden name=command value=<A HREF="#req_merge_do">req_merge_do</A>&gt;\n";
            $contents .= "&lt;h2&gt;Merge request&lt;/h2&gt;\n";
            $contents .= "&lt;select name=from_req&gt;\n";
            $contents .= $requests;
            $contents .= "&lt;/select&gt;&lt;br&gt;\n";
            $contents .= "&lt;h2&gt;Into request&lt;/h2&gt;\n";
            $contents .= "&lt;select name=to_req&gt;\n";
            $contents .= $requests;
            $contents .= "&lt;/select&gt;&lt;br&gt;\n";
            $contents .= "&lt;input type=submit value=\"Merge\"&gt;\n";
            $contents .= "&lt;/form&gt;\n";
            <A HREF="#print_page">print_page</A>("Merge Requests", $contents);
    } ## end sub <B>req_merge</B>    
</PRE>
<HR>

<H2><A NAME="req_merge_do">reqtool/req_merge_do</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_merge_do</B> -- Do the actual merge
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_merge_do</B> ( $req_from, $req_to )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Merge two requests
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req_from - request to merge from
   $req_to   - request to merge into
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display result
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_merge_do</B> {
            my ($req_from, $req_to) = @_;
            my ($req_from_dir, $req_to_dir, $contents, $req_to_index, $req_from_index,
                    @line);
    
            $req_to   = <A HREF="#untaint_num">untaint_num</A>($req_to);
            $req_from = <A HREF="#untaint_num">untaint_num</A>($req_from);
    
            $req_from_dir   = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/" . $req_from;
            $req_to_dir     = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/" . $req_to;
            $req_to_index   = $req_to_dir . "/request.contents";
            $req_from_index = $req_from_dir . "/request.contents";
    
            # Open both requests and write merge action to req_to
            open(REQ_FROM, $req_from_index)
              || <A HREF="#print_error">print_error</A>("Couldn't open From request: $!");
            <A HREF="#lock_read">lock_read</A>(\*REQ_FROM);
            open(REQ_TO, "&gt;&gt;$req_to_index")
              || <A HREF="#print_error">print_error</A>("Couldn't open To request: $!");
            <A HREF="#lock_append">lock_append</A>(\*REQ_TO);
            print REQ_TO "-- New Action --\n";
            print REQ_TO "Action: Merge\n";
            print REQ_TO "Request-Merged: " . $req_from . "\n";
            print REQ_TO "Date: " . localtime(time) . "\n";
            print REQ_TO "-- End Action --\n";
    
            # Copy contents of old request to new request
            while (&lt;REQ_FROM&gt;) {
                    print REQ_TO $_;
            }
            close REQ_TO;
            close REQ_FROM;
            unlink $req_from_index;
            # Move all request data across
            system("/usr/bin/mv " . $req_from_dir . "/* " . $req_to_dir . "/");
            rmdir $req_from_dir;
    
            # Update active index
            system("cp "
                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'} . " "
                      . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'}
                      . "~");
            open(IN, "&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'} . "~")
              || <A HREF="#print_error">print_error</A> "Cannot open: $!";
            <A HREF="#lock_read">lock_read</A>(\*IN);
            open(OUT, "+&lt;" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'})
              || <A HREF="#print_error">print_error</A> "Cannot create: $!";
            <A HREF="#lock_write">lock_write</A>(\*OUT);
    
            while ($_ = &lt;IN&gt;) {
                    @line = split (/\|/, $_, 2);
                    if ($line[0] != $req_from) {
                            print OUT $_;
                    }
            } ## end while ($_ = &lt;IN&gt;)
            close OUT;
            close IN;
            unlink "%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'}~";
    
            # Display results of merge to user
            $contents =
              "Request &lt;font color=blue&gt;"
              . $req_from
              . "&lt;/font&gt; merged into Request &lt;font color=blue&gt;"
              . $req_to
              . "&lt;/font&gt;\n";
            $contents .= "&lt;script&gt;\n";
            $contents .= "top.req_top.location.href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=<A HREF="#req_rescan">req_rescan</A>#Current\"\n";
            $contents .= "top.req_bottom.location.href=\""
              . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}
              . "?command=blank\"\n";
            $contents .= "&lt;/script&gt;\n";
    
            <A HREF="#print_page">print_page</A>("Merge done", $contents);
    } ## end sub <B>req_merge_do</B>    
</PRE>
<HR>

<H2><A NAME="request_stats">reqtool/request_stats</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>request_stats</B> -- Get dates for statistics
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>request_stats</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Displays a form for user to choose date range for statistics generation
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display form
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>request_stats</B> {
            my ($contents, $i);
            $contents = "&lt;h1&gt;&lt;center&gt;Statistics&lt;/center&gt;&lt;/h1&gt;\n";
            $contents .=
              "&lt;form action=\"" . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'} . "\" method=post&gt;\n";
            $contents .= "&lt;input type=hidden name=command value=<A HREF="#display_stats">display_stats</A>&gt;\n";
            $contents .=
    "&lt;center&gt;&lt;b&gt;Choose the start and end dates for which you wish to view statistical information&lt;/b&gt;&lt;/center&gt;&lt;br&gt;\n";
            $contents .= "&lt;center&gt;&lt;table&gt;";
            $contents .= "&lt;tr&gt;&lt;td&gt;&lt;b&gt;Start Date:&amp;nbsp;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;";
            $contents .= "&lt;select name=sDay&gt;";
            $contents .= "&lt;option value=1 selected&gt;1\n";
    
            for ($i = 2 ; $i &lt;= 31 ; $i++) {
                    $contents .= "&lt;option value=" . $i . "&gt;" . $i . "\n";
            }
            $contents .= "&lt;/select&gt;&lt;/td&gt;";
            $contents .= "&lt;td&gt;&lt;select name=sMonth&gt;";
            $contents .= "&lt;option value=Jan selected&gt;Jan\n";
    
            foreach (
                    'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul',
                    'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
              )
            {
                    $contents .= "&lt;option value=" . $_ . "&gt;" . $_ . "\n";
            } ## end foreach ('Feb', 'Mar', 'Apr'...
            $contents .= "&lt;/select&gt;&lt;/td&gt;";
            $contents .= "&lt;td&gt;&lt;select name=sYear&gt;";
            $contents .= "&lt;option value=2000&gt;2000\n";
            $contents .= "&lt;option value=2001 selected&gt;2001\n";
    
            for ($i = 2002 ; $i &lt;= 2010 ; $i++) {
                    $contents .= "&lt;option value=" . $i . "&gt;" . $i . "\n";
            }
            $contents .= "&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt;";
    
            $contents .= "&lt;tr&gt;&lt;td&gt;&lt;b&gt;End Date:&amp;nbsp;&lt;/b&gt;&lt;/td&gt;&lt;td&gt;";
            $contents .= "&lt;select name=eDay&gt;";
            $contents .= "&lt;option value=1 selected&gt;1\n";
            for ($i = 2 ; $i &lt;= 31 ; $i++) {
                    $contents .= "&lt;option value=" . $i . "&gt;" . $i . "\n";
            }
            $contents .= "&lt;/select&gt;&lt;/td&gt;";
            $contents .= "&lt;td&gt;&lt;select name=eMonth&gt;";
            $contents .= "&lt;option value=Jan selected&gt;Jan\n";
    
            foreach (
                    'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul',
                    'Aug', 'Sep', 'Oct', 'Nov', 'Dec'
              )
            {
                    $contents .= "&lt;option value=" . $_ . "&gt;" . $_ . "\n";
            } ## end foreach ('Feb', 'Mar', 'Apr'...
            $contents .= "&lt;/select&gt;&lt;/td&gt;";
            $contents .= "&lt;td&gt;&lt;select name=eYear&gt;";
            $contents .= "&lt;option value=2000&gt;2000\n";
            $contents .= "&lt;option value=2001 selected&gt;2001\n";
    
            for ($i = 2002 ; $i &lt;= 2010 ; $i++) {
                    $contents .= "&lt;option value=" . $i . "&gt;" . $i . "\n";
            }
            $contents .= "&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt;";
            $contents .= "&lt;/table&gt;&lt;/center&gt;";
            $contents .=
              "&lt;center&gt;&lt;input type=submit value=\"View Stats\"&gt;&lt;/center&gt;&lt;br&gt;\n";
            $contents .= "&lt;/table&gt;\n";
            <A HREF="#print_page">print_page</A>("Statistics", $contents);
    } ## end sub <B>request_stats</B>
    
    # Quick substitutions to make stats section more readable</PRE>
<HR>

<H2><A NAME="display_stats">reqtool/display_stats</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>display_stats</B> -- Generate and display statistics
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>display_stats</B> ( $start, $end )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Generate statistics for date range given and display as table
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $start - start date
   $end   - end date
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display table of stats
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>display_stats</B> {
            my ($start, $end, $subject) = @_;
            my (@line, $req, $request, $owner, %stats, $reqline, $state, $time);
            my ($start_time, $taken_time, $resolve_time, $contents, $fullname);
    
            # Define some values to increase readability
            my $state_mail = 1;
            my $state_resolve = 2;
            my $state_other = 3;
    
            # Open resolved index
            open(INDEX, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'})
              || <A HREF="#print_error">print_error</A>("Couldn't open resolved index so no stats could be created");
            <A HREF="#lock_read">lock_read</A>(\*INDEX);
            while (&lt;INDEX&gt;) {
                    $start_time = $taken_time = $resolve_time = 0;
                    @line = split (/\|/, $_, 6);
    
                    # If subject doesn't match
                    if (!($line[5] =~ /$subject/)) {
                            next;
                    }
    
                    # If the request is outside requested dates ignore it
                    if (($line[2] &lt; $start) || ($line[2] &gt; $end)) {
                            next;
                    }
    
                    # Read the request and add the stats for it to global stats
                    $req = $line[0];
                    $req =~ s/R//g;
                    $owner   = $line[1];
                    $request =
                      %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'} . "/" . $req . "/request.contents";
                    open(REQ, $request) || <A HREF="#print_error">print_error</A>("Couldn't open request $req");
                    <A HREF="#lock_read">lock_read</A>(\*REQ);
    
                    while (&lt;REQ&gt;) {
                            chomp $_;
                            @line = split (/: /, $_, 3);
                            if (/^Action: /) {
                                    if ($line[1] eq "Mail") {
                                            $state = $state_mail;
                                    } elsif ($line[1] eq "Resolve") {
                                            $state = $state_resolve;
                                    } else {
                                            $state = $state_other;
                                    }
                            } elsif (/^Date: /) {
                                    $time = str2time($line[1]);
    
                                    if (!$time) {
                                            $time = $line[1];
                                            $time =~ s/.*\((.*)\).*/$1/;
                                    }
                                    if (($state == $state_mail) &amp;&amp; ($start_time == 0)) {
                                            $start_time = $time;
                                    } elsif ($state == $state_resolve) {
                                            $resolve_time = $time;
    
                                            if ($taken_time == 0) {
                                                    $taken_time = $time;
                                            }
                                    } elsif ($taken_time == 0) {
                                            $taken_time = $time;
                                    }
                            } ## end elsif (/^Date: /)
                    } ## end while (&lt;REQ&gt;)
                    close REQ;
    
                    if (($taken_time &gt; 0) &amp;&amp; ($resolve_time &gt; 0) &amp;&amp; ($start_time &gt; 0)) {
                            if (($start_time &gt; $start) &amp;&amp; ($start_time &lt; $end)) {
                                    %stats-&gt;{$owner}-&gt;{reaction} += ($taken_time - $start_time);
                                    %stats-&gt;{$owner}-&gt;{resolve}  += ($resolve_time - $taken_time);
                                    %stats-&gt;{$owner}-&gt;{count}    += 1;
                                    %stats-&gt;{"ze Total"}-&gt;{reaction} += ($taken_time - $start_time);
                                    %stats-&gt;{"ze Total"}-&gt;{resolve}  +=
                                      ($resolve_time - $taken_time);
                                    %stats-&gt;{"ze Total"}-&gt;{count} += 1;
                            } ## end if (($start_time &gt; $start...
                    } ## end if (($taken_time &gt; 0) ...
            } ## end while (&lt;INDEX&gt;)
            close INDEX;
    
            $contents = "&lt;table border=2 cellpadding=5&gt;\n";
            $contents .=
              "&lt;tr&gt;&lt;th colspan=4 bgcolor=#ffffcc&gt;Reqtool Statistics&lt;/th&gt;&lt;/tr&gt;\n";
            $contents .= "&lt;tr&gt;&lt;th colspan=4 bgcolor=#ffffcc&gt;"
              . localtime($start) . " to "
              . localtime($end)
              . "&lt;/th&gt;&lt;/tr&gt;\n";
            $contents .=
    "&lt;tr bgcolor=#99ffcc&gt;&lt;td&gt;&lt;b&gt;Login&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Count&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Reaction time&lt;/b&gt;&lt;/td&gt;&lt;td&gt;&lt;b&gt;Resolve time&lt;/b&gt;&lt;/td&gt;&lt;/tr&gt;\n";
    
            # Sort hash by login and display stats for each login
            foreach (sort keys(%stats)) {
                    (undef, undef, undef, undef, undef, undef, $fullname) = getpwnam($_);
                    if ($_ eq "ze Total") {
                            $contents .= "&lt;tr bgcolor=#ffcccc&gt;";
                            $contents .= "&lt;td bgcolor=#ffcccc&gt;&lt;b&gt;" . $_ . "&lt;/b&gt;&lt;/td&gt;";
                    } elsif ($fullname) {
                            $contents .= "&lt;tr&gt;";
                            $contents .= "&lt;td bgcolor=#ccccff&gt;" . $fullname . "&lt;/td&gt;";
                    } else {
                            $contents .= "&lt;tr&gt;";
                            $contents .= "&lt;td bgcolor=#ccccff&gt;" . $_ . "&lt;/td&gt;";
                    }
                    $contents .= "&lt;td&gt;" . %stats-&gt;{$_}-&gt;{count} . "&lt;/td&gt;";
                    $contents .= "&lt;td&gt;"
                      . <A HREF="#date_diff">date_diff</A>(0, int(%stats-&gt;{$_}-&gt;{reaction} / %stats-&gt;{$_}-&gt;{count}))
                      . "&lt;/td&gt;";
                    $contents .= "&lt;td&gt;"
                      . <A HREF="#date_diff">date_diff</A>(0, int(%stats-&gt;{$_}-&gt;{resolve} / %stats-&gt;{$_}-&gt;{count}))
                      . "&lt;/td&gt;";
                    $contents .= "&lt;/tr&gt;\n";
            } ## end foreach (sort keys(%stats))
            $contents .= "&lt;/table&gt;\n";
    
            <A HREF="#print_page">print_page</A>("Statistics", $contents);
    } ## end sub <B>display_stats</B>    
</PRE>
<HR>

<H2><A NAME="rebuild_indexes">reqtool/rebuild_indexes</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>rebuild_indexes</B> -- Rebuild an index file from a directory
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>rebuild_indexes</B> ( $dir, $indexfile, $status )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Rebuild an index file from a directory
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $dir       - directory to re-create from
   $indexfile - index to re-create
   $status    - status of requests (open/resolved)
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>rebuild_indexes</B> {
            my ($dir, $indexfile, $status) = @_;
            my ($req, $date, $subject, $owner, $from, @line, @reqs);
    
            # Open the directory to find all available requests
            opendir(DIR, $dir) || die ("Couldn't opendir " . $dir . ": $!");
            open(INDEXFILE, "+&lt;" . $indexfile) || die ("couldn't open $indexfile");
            <A HREF="#lock_write">lock_write</A>(\*INDEXFILE);
    
            # We only care about numbered requests
            @reqs = grep { /[0-9]/ } readdir(DIR);
            @reqs = sort { $a &lt;=&gt; $b } @reqs;
            # Parse each request and add to indexfile
            foreach (@reqs) {
                    $req = $_;
                    if (!open(REQ, $dir . "/" . $req . "/request.contents")) {
                            print STDERR
    "Couldn't open request.contents for $req\nLooks like directory damaged...ignoring\n";
                    } else {
                            <A HREF="#lock_read">lock_read</A>(\*REQ);
                            $owner = $from = $subject = $date = "";
    
                            while (&lt;REQ&gt;) {
                                    chomp;
                                    @line = split (/: /, $_, 2);
                                    if ((/^Date: /) &amp;&amp; ($date eq "")) {
                                            $date = str2time($line[1]);
                                            if (!$date) {
                                                    $date = $line[1];
                                                    $date =~ s/.*\((.*)\).*/$1/;
                                            }
                                    } elsif (/^Owner: /) {
                                            $owner = $line[1];
                                    } elsif ((/^From: /) &amp;&amp; ($from eq "")) {
                                            $from = $line[1];
                                    } elsif ((/^Subject: /) &amp;&amp; ($subject eq "")) {
                                            $subject = $_;
                                            $subject =~ s/^Subject: //g;
                                    }
                            } ## end while (&lt;REQ&gt;)
    
                            if ($owner eq "") {
                                    $owner = "none";
                            }
                            if ($status eq "resolved") {
                                    $req .= "R";
                            }
                            print INDEXFILE $req . "|" . $owner . "|" . $date . "|" . $status
                              . "|"
                              . $from . "|"
                              . $subject . "\n";
                            close REQ;
                    } ## end else
            } ## end foreach (@reqs)
            close INDEXFILE;
            close DIR;
    } ## end sub <B>rebuild_indexes</B>    
</PRE>
<HR>

<H2><A NAME="req_status">reqtool/req_status</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>req_status</B> -- Display <A HREF="#reqtool">reqtool</A> status area
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>req_status</B> ( $req, $status)
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Display what is the current request
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $req    - current request number
   $status - not used currently
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Calls <A HREF="#print_page">print_page</A> to display request number
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>req_status</B> {
            my ($req, $status) = @_;
            my ($contents);
            if ($req eq "") {
                    $req = "Not selected";
            }
            $contents .=
              "&lt;b&gt;Current Request is &lt;font color=blue&gt;" . $req . "&lt;/font&gt;&lt;/b&gt;\n";
            <A HREF="#print_page">print_page</A>("Status", $contents);
    } ## end sub <B>req_status</B>    
</PRE>
<HR>

<H2><A NAME="print_usage">reqtool/print_usage</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>print_usage</B> -- Print command-line usage
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>print_usage</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Displays <A HREF="#reqtool">reqtool</A> command-line usage to terminal
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Usage to STDOUT
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>print_usage</B> {
            print "Usage: <A HREF="#reqtool">reqtool</A> [- | -r]\n";
            print "supported options:\n";
            print "   -     Read an email from STDIN and create a new open request\n";
            print "   -r    Rebuild active/resolved indexfiles\n";
            print "\n";
    } ## end sub <B>print_usage</B>    
</PRE>
<HR>

<H2><A NAME="load_config">reqtool/load_config</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>load_config</B> -- Load configuration of given queue
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   <B>load_config</B>
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Loads configuration of queue given in QUEUE into %<A HREF="#qconfig">qconfig</A>
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>load_config</B> {
    
            # Set some initial defaults. Will be overridden by config values
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#QUEUE_DIR">QUEUE_DIR</A>'} =
              %<A HREF="#qconfig">qconfig</A>-&gt;{'GLOBAL_DIR'} . "/" . %<A HREF="#qconfig">qconfig</A>-&gt;{'QUEUE'};
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CGI_NAME">CGI_NAME</A>'}       = "/cgi-bin/<A HREF="#reqtool">reqtool</A>";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LISTNAME">LISTNAME</A>'}       = "Reqtool Request";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#MAILING_LIST">MAILING_LIST</A>'}   = "<A HREF="#reqtool">reqtool</A>-test\@bogus.com";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#TMP_DIR">TMP_DIR</A>'}        = "/tmp";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ADMIN_PASSWORD">ADMIN_PASSWORD</A>'} = "<A HREF="#reqtool">reqtool</A>";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#READ_USER">READ_USER</A>'}      = "sales";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#CHARSET">CHARSET</A>'}        = "ISO-2022-JP";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}           = 0;
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_SERVER">LDAP_SERVER</A>'}    = "";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BASE">LDAP_BASE</A>'}      = "";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BIND">LDAP_BIND</A>'}      = "";
    
            open(CONFIG, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#QUEUE_DIR">QUEUE_DIR</A>'} . "/config")
              || die ("Could not open config file : $!");
            while (&lt;CONFIG&gt;) {
                    my @line = split (/=/, $_, 2);
                    $line[0] =~ /^\s*(.*?)\s*$/;
                    $line[0] = $1;
                    $line[1] =~ /^\s*(.*?)\s*$/;
                    $line[1] = $1;
                    %<A HREF="#qconfig">qconfig</A>-&gt;{ $line[0] } = <A HREF="#untaint_str">untaint_str</A>($line[1]);
            } ## end while (&lt;CONFIG&gt;)
            close CONFIG;
    
            # Setting based of config values
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_DIR">FORWARD_DIR</A>'}  = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#QUEUE_DIR">QUEUE_DIR</A>'} . "/forward";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_FILE">FORWARD_FILE</A>'} = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#FORWARD_DIR">FORWARD_DIR</A>'} . "/.forwards.html";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#MIME_TYPES">MIME_TYPES</A>'}   = %<A HREF="#qconfig">qconfig</A>-&gt;{'GLOBAL_DIR'} . "/mime.types";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#COUNTFILE">COUNTFILE</A>'}    = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#QUEUE_DIR">QUEUE_DIR</A>'} . "/<A HREF="#reqtool">reqtool</A>.count";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'}   = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#QUEUE_DIR">QUEUE_DIR</A>'} . "/active";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'} = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/indexfile";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#IMAGE_PATH">IMAGE_PATH</A>'}   = %<A HREF="#qconfig">qconfig</A>-&gt;{'GLOBAL_DIR'} . "/images";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#VALID_USERS">VALID_USERS</A>'}  = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#QUEUE_DIR">QUEUE_DIR</A>'} . "/valid.users";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'} = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#QUEUE_DIR">QUEUE_DIR</A>'} . "/resolved";
            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'} = %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'} . "/indexfile";
    
            # Load <A HREF="#LDAP">LDAP</A> module if required
            if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}) {
                    use Net::<A HREF="#LDAP">LDAP</A>;
            }
    
            # rename program for ps listing
            $0 = "<A HREF="#reqtool">reqtool</A> - " . %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LISTNAME">LISTNAME</A>'};
    
    } ## end sub <B>load_config</B>    
</PRE>
<HR>

<H2><A NAME="un_base64">reqtool/un_base64</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>un_base64</B> -- Decode base64
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   $text = <B>un_base64</B> ( $str, $icode )
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Decode base64 for email headers when in other language
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   $str   - string to decode
   $icode - unsure
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   $text - decoded string
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    sub <B>un_base64</B> {
            my ($str, $icode) = @_;
            my $len = length($str) * 3 / 4;
            $len -= length($1) if ($str =~ /(=+)$/);
            $icode =~ tr/A-Z/a-z/;
            $str   =~ tr#A-Za-z0-9+/=#`!-_`#;
            $str = chr($len + 32) . $str . "\n";
            $str = unpack("u", $str);
            my $alias = {
                    "iso-2022-jp" =&gt; "jis",
                    "euc-jp"      =&gt; "euc",
                    "shift_jis"   =&gt; "sjis",
            };
            $icode = $alias-&gt;{$icode} if $alias-&gt;{$icode};
            return $str;
    } ## end sub <B>un_base64</B>    
</PRE>
<HR>

<H2><A NAME="main_code">reqtool/main_code</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>main_code</B> - main code section, not in subroutine
</EM></PRE><FONT SIZE="+1">SYNOPSIS</FONT>
<PRE>   No output
</PRE><FONT SIZE="+1">FUNCTION</FONT>
<PRE>   Figure out where to go
</PRE><FONT SIZE="+1">INPUTS</FONT>
<PRE>   Commandline, cgi parameters
</PRE><FONT SIZE="+1">OUTPUT</FONT>
<PRE>   Everything
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    my (%cookie, $req, $login, $image, $password);
    
    # set umask
    umask 0002;
    
    # Much selection goes on here
    # It will branch to the correct section based on command line and values
    # passed via the CGI interface
    
    # Check for command-line args and set queue dependant on argv[0]
    # Or grab queue from environment when running via CGI
    if ($ARGV[0]) {
            if ($ARGV[0] eq "-v") {
                    print "Reqtool Version: " . $<A HREF="#VERSION">VERSION</A> . "\n";
                    exit;
            } else {
                    %<A HREF="#qconfig">qconfig</A>-&gt;{'QUEUE'} = $ARGV[0];
                    %<A HREF="#qconfig">qconfig</A>-&gt;{'QUEUE'} = <A HREF="#untaint_str">untaint_str</A>(%<A HREF="#qconfig">qconfig</A>-&gt;{'QUEUE'});
            }
    } else {
            if ($ENV{PATH_INFO}) {
                    %<A HREF="#qconfig">qconfig</A>-&gt;{'QUEUE'} = $ENV{PATH_INFO};
                    %<A HREF="#qconfig">qconfig</A>-&gt;{'QUEUE'} =~ s/\///g;
                    %<A HREF="#qconfig">qconfig</A>-&gt;{'QUEUE'} = <A HREF="#untaint_str">untaint_str</A>(%<A HREF="#qconfig">qconfig</A>-&gt;{'QUEUE'});
            } else {
                    %<A HREF="#qconfig">qconfig</A>-&gt;{'QUEUE'} = "default";
            }
    } ## end else
    
    <A HREF="#load_config">load_config</A>();
    
    # If there is a second argument then branch on it
    if ($ARGV[1]) {
            if ($ARGV[1] eq '-') {
                    <A HREF="#read_email">read_email</A>();
            } elsif ($ARGV[1] eq "-r") {
                    <A HREF="#rebuild_indexes">rebuild_indexes</A>(
                            %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'}, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'},
                            "resolved"
                    );
                    <A HREF="#rebuild_indexes">rebuild_indexes</A>(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'}, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'},
                            "open");
            } else {
                    <A HREF="#print_usage">print_usage</A>();
                    exit;
            }
    } elsif (param('command')) {  # Check if we are called to do specific thing
    
            # Fetch cookies
            %cookie = fetch CGI::Cookie;
    
            # Grab request number
            if ($cookie{'request'}) {
                    $req = $cookie{'request'}-&gt;value;
            } else {
                    $req = 0;
            }
    
            # Grab login name, or display login screen
            if ($cookie{'login'}) {
                    $login = $cookie{'login'}-&gt;value;
            } else {
                    if (param('command') eq "login") {
                            <A HREF="#login_check">login_check</A>(param('login'), param('password'));
                    } else {
                            <A HREF="#display_login">display_login</A>();
                    }
            } ## end else
    
            # Find fullname if we have <A HREF="#LDAP">LDAP</A>
            my $fullname = "";
            if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}) {
                    my $<A HREF="#LDAP">LDAP</A> = Net::<A HREF="#LDAP">LDAP</A>-&gt;new(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_SERVER">LDAP_SERVER</A>'}) || die "$@";
                    my $mesg = $<A HREF="#LDAP">LDAP</A>-&gt;search(
                            base   =&gt; %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP_BASE">LDAP_BASE</A>'},
                            attrs  =&gt; ['cn'],
                            filter =&gt; "(uid=" . $login . ")"
                    );
                    $fullname = $mesg-&gt;entry(0)-&gt;get_value("cn");
            } ## end if (%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#LDAP">LDAP</A>'}...
    
            # Branch based on contents of command parameter
            if (param('command') eq "blank") {
                    <A HREF="#print_page">print_page</A>("", "");
            } elsif (param('command') eq "<A HREF="#buttons">buttons</A>") {
                    <A HREF="#display_buttons">display_buttons</A>();
            } elsif (param('command') eq "<A HREF="#display_stats">display_stats</A>") {
                    my $start =
                      param('sDay') . " " . param('sMonth') . " " . param('sYear');
                    my $end = param('eDay') . " " . param('eMonth') . " " . param('eYear');
                    if (param('subject')) {
                            $subject = param('subject');
                    } else {
                            $subject = "";
                    }
                    <A HREF="#display_stats">display_stats</A>(str2time($start), str2time($end), $subject);
            } elsif (param('command') eq "download") {
                    $req = param('req');
    
                    if ($req =~ /R/) {
                            <A HREF="#send_attachment">send_attachment</A>(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'} . "/" . param('file'));
                    } else {
                            <A HREF="#send_attachment">send_attachment</A>(%<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'} . "/" . param('file'));
                    }
            } elsif (param('command') eq "getimage") {
                    <A HREF="#send_image">send_image</A>(param('image'));
            } elsif (param('command') eq "list") {
                    <A HREF="#req_rescan">req_rescan</A>($req);
            } elsif (param('command') eq "view") {
                    $req = param('req');
                    <A HREF="#view_request">view_request</A>($req);
            } elsif (param('command') eq "<A HREF="#req_comments">req_comments</A>") {
                    <A HREF="#req_comments">req_comments</A>();
            } elsif (param('command') eq "<A HREF="#req_comments_do">req_comments_do</A>") {
                    <A HREF="#req_comments_do">req_comments_do</A>($req, $login, param('comments'), $fullname);
            } elsif (param('command') eq "req_drop") {
                    <A HREF="#req_resolve">req_resolve</A>($req, "dropped", $fullname);
            } elsif (param('command') eq "<A HREF="#req_give">req_give</A>") {
                    <A HREF="#req_give">req_give</A>();
            } elsif (param('command') eq "<A HREF="#req_give_do">req_give_do</A>") {
    
                    if ($req) {
                            <A HREF="#req_give_do">req_give_do</A>($req, param('username'), $login);
                    } else {
                            <A HREF="#print_page">print_page</A>("Error", "&lt;h1&gt;No Request Selected&lt;/h1&gt;");
                    }
            } elsif (param('command') eq "<A HREF="#req_mail">req_mail</A>") {
    
                    if ($req) {
                            <A HREF="#req_mail">req_mail</A>($req);
                    } else {
                            <A HREF="#req_mail">req_mail</A>(0);
                    }
            } elsif (param('command') eq "<A HREF="#req_mail_do">req_mail_do</A>") {
    
                    # If we have an attachment then call <A HREF="#req_mail_do">req_mail_do</A> differently
                    if (param('attach')) {
                            <A HREF="#req_mail_do">req_mail_do</A>(
                                    $req,
                                    $login,
                                    param('address'),
                                    param('cc'),
                                    param('subject'),
                                    param('mail'),
                                    param('attach'),
                                    tmpFileName(param('attach')),
                                    uploadInfo(param('attach'))-&gt;{'Content-Type'},
                                    uploadInfo(param('attach'))-&gt;{'Encoding'}
                            );
                    } else {
                            <A HREF="#req_mail_do">req_mail_do</A>(
                                    $req,             $login,
                                    param('address'), param('cc'),
                                    param('subject'), param('mail'),
                                    param('attach'),  "",
                                    "",               ""
                            );
                    } ## end else
    
                    if (param('resolve')) {
    
                            # Wait for 20 sec to allow mail to be processed
                            sleep 20;
                            <A HREF="#req_resolve">req_resolve</A>($req, $login);
                    } ## end if (param('resolve'))
            } elsif (param('command') eq "<A HREF="#req_merge">req_merge</A>") {
                    <A HREF="#req_merge">req_merge</A>($req);
            } elsif (param('command') eq "<A HREF="#req_merge_do">req_merge_do</A>") {
                    <A HREF="#req_merge_do">req_merge_do</A>(param('from_req'), param('to_req'));
            } elsif (param('command') eq "<A HREF="#req_parameters">req_parameters</A>") {
                    <A HREF="#req_parameters">req_parameters</A>();
            } elsif (param('command') eq "<A HREF="#req_rescan">req_rescan</A>") {
                    <A HREF="#req_rescan">req_rescan</A>($req);
            } elsif (param('command') eq "<A HREF="#req_resolve">req_resolve</A>") {
    
                    if ($req) {
                            <A HREF="#req_resolve">req_resolve</A>($req, $login);
                    } else {
                            <A HREF="#print_page">print_page</A>("Error", "&lt;h1&gt;No Request Selected&lt;/h1&gt;");
                    }
            } elsif (param('command') eq "<A HREF="#req_search">req_search</A>") {
                    <A HREF="#req_search">req_search</A>();
            } elsif (param('command') eq "<A HREF="#req_search_do">req_search_do</A>") {
                    <A HREF="#req_search_do">req_search_do</A>(
                            param('query'),  param('searchby'),
                            param('active'), param('resolved')
                    );
            } elsif (param('command') eq "req_statistics") {
                    <A HREF="#request_stats">request_stats</A>();
            } elsif (param('command') eq "<A HREF="#req_status">req_status</A>") {
                    <A HREF="#req_status">req_status</A>($req);
            } elsif (param('command') eq "req_take") {
    
                    if ($req) {
                            <A HREF="#take_request">take_request</A>($req, $login);
                    } else {
                            <A HREF="#print_page">print_page</A>("Error", "&lt;h1&gt;No Request Selected&lt;/h1&gt;");
                    }
            } elsif (param('command') eq "admin") {
    
                    # Enter administration section
                    if ($cookie{'admin'}) {
                            $password = $cookie{'admin'}-&gt;value;
                    } else {
                            if (param('password')) {
                                    $password = param('password');
                            } else {
                                    <A HREF="#req_parameters">req_parameters</A>();
                            }
                    } ## end else
    
                    # Check that admin password is correct
                    if ($password eq %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ADMIN_PASSWORD">ADMIN_PASSWORD</A>'}) {
                            if (param('admin')) {
                                    if (param('admin') eq "<A HREF="#admin_forward">admin_forward</A>") {
                                            <A HREF="#admin_forward">admin_forward</A>();
                                    } elsif (param('admin') eq "<A HREF="#admin_forward_do">admin_forward_do</A>") {
                                            <A HREF="#admin_forward_do">admin_forward_do</A>(param('address'), param('mail'),
                                                    param('current'));
                                    } elsif (param('admin') eq "<A HREF="#admin_users">admin_users</A>") {
                                            <A HREF="#admin_users">admin_users</A>();
                                    } elsif (param('admin') eq "<A HREF="#admin_users_do">admin_users_do</A>") {
                                            <A HREF="#admin_users_do">admin_users_do</A>(param('users'));
                                    } elsif (param('admin') eq "admin_index") {
                                            <A HREF="#rebuild_indexes">rebuild_indexes</A>(
                                                    %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>'},
                                                    %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#RESOLVED_INDEX">RESOLVED_INDEX</A>'},
                                                    "resolved"
                                            );
                                            <A HREF="#rebuild_indexes">rebuild_indexes</A>(
                                                    %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>'}, %<A HREF="#qconfig">qconfig</A>-&gt;{'<A HREF="#ACTIVE_INDEX">ACTIVE_INDEX</A>'},
                                                    "open"
                                            );
                                            <A HREF="#print_page">print_page</A>("Updated Indexes", "Updated Indexes");
                                    } else {
                                            <A HREF="#admin_main">admin_main</A>($password);
                                    }
                            } else {
                                    <A HREF="#admin_main">admin_main</A>($password);
                            }
                    } else {
                            <A HREF="#req_parameters">req_parameters</A>();
                    }
            } ## end elsif (param('command') eq...
    } else {
            %cookie = fetch CGI::Cookie;
    
            if ($cookie{'login'}) {
                    $login = $cookie{'login'}-&gt;value;
                    <A HREF="#display_frames">display_frames</A>();
            } else {
                    <A HREF="#display_login">display_login</A>();
            }
    } ## end else    
</PRE>
<HR>

<H2><A NAME="QUEUE_DIR">reqtool/QUEUE_DIR</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>QUEUE_DIR</B> - Directory of queue
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   GLOBAL_DIR/<B>QUEUE_DIR</B>
</EM></PRE>
<HR>

<H2><A NAME="CGI_NAME">reqtool/CGI_NAME</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>CGI_NAME</B> - Name of CGI script
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>  Given by config file 
</EM></PRE>
<HR>

<H2><A NAME="LISTNAME">reqtool/LISTNAME</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>LISTNAME</B> - Name of mailing list
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="MAILING_LIST">reqtool/MAILING_LIST</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>MAILING_LIST</B> - address of mailing list
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="TMP_DIR">reqtool/TMP_DIR</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>TMP_DIR</B> - Temporary directory
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="ADMIN_PASSWORD">reqtool/ADMIN_PASSWORD</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>ADMIN_PASSWORD</B> - Password to administration section
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="READ_USER">reqtool/READ_USER</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>READ_USER</B> - Username of read-only user
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="CHARSET">reqtool/CHARSET</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>CHARSET</B> - Character set
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="LDAP_SERVER">reqtool/LDAP_SERVER</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>LDAP_SERVER</B> - hostname of <A HREF="#LDAP">LDAP</A> server
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="LDAP_BASE">reqtool/LDAP_BASE</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>LDAP_BASE</B> - Base dn for bind
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="LDAP_BIND">reqtool/LDAP_BIND</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>LDAP_BIND</B> - Full dn for bind
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="LDAP">reqtool/LDAP</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>LDAP</B> - Boolean value say yay/nay to <B>LDAP</B>
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   Given by config file
</EM></PRE>
<HR>

<H2><A NAME="FORWARD_DIR">reqtool/FORWARD_DIR</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>FORWARD_DIR</B> - Directory of forwards
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   GLOBAL_DIR/forward
</EM></PRE>
<HR>

<H2><A NAME="FORWARD_FILE">reqtool/FORWARD_FILE</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>FORWARD_FILE</B> - Forward file
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   <A HREF="#FORWARD_DIR">FORWARD_DIR</A>/.forwards.html
</EM></PRE>
<HR>

<H2><A NAME="MIME_TYPES">reqtool/MIME_TYPES</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>MIME_TYPES</B> - List of mime types
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   GLOBAL_DIR/mime.types
</EM></PRE>
<HR>

<H2><A NAME="COUNTFILE">reqtool/COUNTFILE</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>COUNTFILE</B> - Next request counter
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   <A HREF="#QUEUE_DIR">QUEUE_DIR</A>/<A HREF="#reqtool">reqtool</A>.count
</EM></PRE>
<HR>

<H2><A NAME="ACTIVE_DIR">reqtool/ACTIVE_DIR</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>ACTIVE_DIR</B> - Directory of active requests
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   <A HREF="#QUEUE_DIR">QUEUE_DIR</A>/active
</EM></PRE>
<HR>

<H2><A NAME="ACTIVE_INDEX">reqtool/ACTIVE_INDEX</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>ACTIVE_INDEX</B> - Index of active requests
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   <A HREF="#ACTIVE_DIR">ACTIVE_DIR</A>/indexfile
</EM></PRE>
<HR>

<H2><A NAME="IMAGE_PATH">reqtool/IMAGE_PATH</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>IMAGE_PATH</B> - Path to images for <A HREF="#buttons">buttons</A>
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   GLOBAL_DIR/images
</EM></PRE>
<HR>

<H2><A NAME="VALID_USERS">reqtool/VALID_USERS</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>VALID_USERS</B> - List of valid users
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   <A HREF="#QUEUE_DIR">QUEUE_DIR</A>/valid.users
</EM></PRE>
<HR>

<H2><A NAME="RESOLVED_DIR">reqtool/RESOLVED_DIR</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>RESOLVED_DIR</B> - Directory of resolved requests
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   <A HREF="#QUEUE_DIR">QUEUE_DIR</A>/resolved
</EM></PRE>
<HR>

<H2><A NAME="RESOLVED_INDEX">reqtool/RESOLVED_INDEX</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   <B>RESOLVED_INDEX</B> - Index of resolved requests
</EM></PRE><FONT SIZE="+1">NOTES</FONT>
<PRE><EM>   <A HREF="#RESOLVED_DIR">RESOLVED_DIR</A>/indexfile
</EM></PRE>
<HR>

<H2><A NAME="pod">reqtool/pod</A></H2>

<FONT SIZE="+1">NAME</FONT>
<PRE><EM>   Pod documentation
</EM></PRE><FONT SIZE="+1">DESCRIPTION</FONT>
<PRE>   Documentation for <A HREF="#reqtool">reqtool</A> that is displayed by perldoc
</PRE><FONT SIZE="+1">SOURCE</FONT>
<PRE>    =head1 NAME
    
    <A HREF="#reqtool">reqtool</A> - Request Tracking Tool
    
    =head1 SYNOPSIS
    
    cat I&lt;email&gt; | B&lt;<A HREF="#reqtool">reqtool</A>&gt; I&lt;queue&gt; -
    
    or <A HREF="#reqtool">reqtool</A> [ I&lt;queue&gt; C&lt;-r&gt; | C&lt;-v&gt; ]
    
    or call directly as a CGI script
    
    =head1 DESCRIPTION
    
    When run from a terminal B&lt;<A HREF="#reqtool">reqtool</A>&gt; takes standard in and processes it to be added to the tracking system.
    It will mainly be used from a web browser where it provides an interface to work with the individual requests.
    When called from the web the queue is set by calling it as B&lt;<A HREF="#reqtool">reqtool</A>/I&lt;queue&gt;&gt;
    
    =head1 OPTIONS
    
    =over 4
    
    =item There is are three command line options
    
    =item B&lt;-&gt;
    
    Take email from standard in
    Queue name needs to be set on commandline
    
    =item B&lt;-r&gt;
    
    Rebuild indexfiles from request directories
    Use this is your indexfiles get corrupted or you manually change the contents of the active/resolved directories
    Queue name needs to be set on commandline
    
    =item B&lt;-v&gt;
    
    Get <A HREF="#reqtool">reqtool</A> version
    
    =back
    
    =head1 CONFIGURATION
    
    All configuration is done by editing the config file in the directory of each queue
    
    =head1 REQUIRES
    
    Perl 5.6 or later, CGI, MIME::Parser, Sys::Hostname, Date::Parse, Net::<A HREF="#LDAP">LDAP</A> is optional
    
    =head1 AUTHOR
    
    Chris Debenham &lt;Chris.Debenham@Sun.Com&gt;
    
    =head1 COPYRIGHT
    
    This program is released under the GPL (<A HREF="http://www.gnu.org/copyleft/gpl.html)">http://www.gnu.org/copyleft/gpl.html)</A>
    
    =head1 <A HREF="#VERSION">VERSION</A>
    
    Reqtool version 0.12
    
    =head1 THANKS
    
    This was based on the great work by the authors of Reqng which was inturn based on req but contains no code from either of those original programs.
    
    Thanks go to Remy Evard and other members of the systems group at Northeastern University's College of Computer Science (<A HREF="http://www.ccs.neu.edu)">http://www.ccs.neu.edu)</A> for thier work on the original req.
    
    Thanks also go to the authors of ReqNG (<A HREF="http://reqng.sycore.net/reqng)">http://reqng.sycore.net/reqng)</A> and WWWREQ (<A HREF="http://www.cs.ucr.edu/~cvarner/wwwreq/)">http://www.cs.ucr.edu/~cvarner/wwwreq/)</A> which the interface was based on.
    
    =cut    
</PRE>
</BODY></HTML>
